
<!DOCTYPE html>
<html lang="ZH">
<head>
    <title>扫码勾选</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../libs/customer/index.css">
    <style scoped>
        .hide-dialog {
            display: none;
        }
    </style>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/font-awesome.min.css">
    <link rel="stylesheet" href="../../plugins/jqgrid/ui.jqgrid-bootstrap.css">
    <link rel="stylesheet" href="../../plugins/ztree/css/metroStyle/metroStyle.css">
    <link rel="stylesheet" href="../../css/main.css">

    <script src="../../libs/jquery.min.js"></script>
    <script src="../../plugins/layer/layer.js"></script>
    <script src="../../libs/bootstrap.min.js"></script>
    <script src="../../libs/vue.min.js"></script>
    <script src="../../plugins/jqgrid/grid.locale-cn.js"></script>
    <script src="../../plugins/jqgrid/jquery.jqGrid.min.js"></script>
    <script src="../../plugins/ztree/jquery.ztree.all.min.js"></script>
    <script src="../../js/common.js"></script>
    <script src="../../libs/customer/index.js"></script>
    <script src="../../js/autoRem.js"></script>

</head>
<style type="text/css">
    [v-cloak] {
        display: none;
    }

    .hideItem {
        display: none;
    }

    .showItem {
        display: block;
    }

    .form-row {
        width: 100%;
        display: flex;
        flex-direction: row;
    }

    .hidebox {
        display: none;
    }

    .el-col-11 {
        width: auto;
    }

    .checkMsg {
        transform: translateY(-0.05rem);;
    }
</style>
<body>
<iframe id="ifile" style="display:none"></iframe>
<div id="rrapp" v-cloak>

    <div>

        <el-form ref="form" :model="form" label-width="1.0rem">
            <el-row>
                <el-col :span="12">
                    <el-form-item label="扫码:" class="form-item" label-width="0.55rem" style="position: relative">
                        <el-input :autofocus="true" id="autofocusinput" type="password" ref="scanCode" v-model="form.scanCode"
                                  placeholder="请扫描发票二维码" @change="add"></el-input>
                    </el-form-item>
                </el-col>
                <el-col :span="12">
                    <el-form-item label="发票代码:" class="form-item" id="requireMsg1">
                        <el-input v-model="form.invoiceCode" maxlength="12" placeholder="请输入发票代码"></el-input>
                    </el-form-item>
                </el-col>
                <el-col :span="12">
                    <el-form-item label="发票号码:" class="form-item" id="requireMsg2">
                        <el-input v-model="form.invoiceNo" maxlength="8" placeholder="请输入发票号码"></el-input>
                    </el-form-item>
                </el-col>
                <el-col :span="12">
                    <el-form-item label="金额:" class="form-item" id="requireMsg3">
                        <el-input v-model="form.invoiceAmount" placeholder="请输入发票金额"></el-input>
                    </el-form-item>
                </el-col>
                <el-col :span="12">
                    <el-form-item label="校验码:" class="form-item hideItem" id="requireMsg5">
                        <el-input v-model="form.invoiceAmount" placeholder="请输入校验码" maxlength="6"></el-input>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="12">
                    <el-form-item label="开票日期:" class="form-item" id="requireMsg4">
                        <el-date-picker type="date" :clearable="false" :disabled="false" placeholder="选择日期"
                                        @blur="blurpickerchange(1)"
                                        @focus="focuspickerchange(1)"
                                        :picker-options="checkInvoiceDate" :editable="false"
                                        v-model="form.invoiceDate" default-value="" format="yyyy-MM-dd"
                                        value-format="yyyy-MM-dd" @change="invoiceDate"></el-date-picker>
                    </el-form-item>
                </el-col>
                <el-col :span="1" :offset="1">
                    <el-button class="btnexport" @click="save">保存</el-button>
                </el-col>
                <el-col :span="1" :offset="1">
                    <el-button class="btnexport" @click="reset">重置</el-button>
                </el-col>
                <el-col :span="1" :offset="1">
                    <el-button class="btnexport" @click="check()">发票勾选</el-button>
                </el-col>
            </el-row>
        </el-form>
    </div>
    <hr>

    <div class="h15"></div>
    <el-table height="4rem" border fit :data="tableData" highlight-current-row style="width: 100%;font-size: 0.12rem;"
              style="width: 100%; margin-top: 0.2rem" @selection-change="changeFun">

        <el-table-column :show-overflow-tooltip="true"  type="selection" width="55" align="center" class="selection" prop='uuid'
                         :selectable='checkboxInit'
                         @selection-change="changeFun"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  type="index" width="100" label="序号" align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  prop="noAuthTip" label="不可勾选提示" align="left" header-align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  prop="invoiceCode" label="发票代码" align="left" header-align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  prop="id" label="id" v-if='show' align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  prop="invoiceNo" label="发票号码" align="left" header-align="center">
            <template scope="scope">
                <span>{{ scope.row.invoiceNo }}</span>
                <el-tooltip class="item" effect="dark" placement="top-start">
                    <div slot="content" v-if="scope.row.invoiceType== '01' ">增值税专用发票</div>
                    <img v-if="scope.row.invoiceType== '01'" style="height:0.2rem;" src="../../img/special-invoice.png"/>
                    <div slot="content" v-if="scope.row.invoiceType== '03' ">机动车销售统一发票</div>
                    <img v-if="scope.row.invoiceType== '03' " style="height:0.2rem;" src="../../img/motor-vehicles.png"/>
                    <div slot="content" v-if="scope.row.invoiceType== '14' ">增值税电子普通发票（通行费）</div>
                    <img v-if="scope.row.invoiceType== '14' " style="height:0.2rem;" src="../../img/general-invoice.png"/>
                </el-tooltip>
            </template>
        </el-table-column>
        <el-table-column :show-overflow-tooltip="true"  prop="invoiceDate" label="开票日期" align="center"
                         :formatter="formatInvoiceDate"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  prop="invoiceAmount" label="金额" align="right" header-align="center"
                         :formatter="invoiceAmountFormatDecimal"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  prop="checkCode" label="校验码" align="center"></el-table-column>
    </el-table>
</div>
<script type="text/javascript" charset="utf-8" src="../../js/customer/resource.js"></script>


<script>
    var dataList = [];
    var currentIds = [];
    Vue.http.options.emulateJSON = true;
    Vue.http.options.emulateHTTP = true;
    var vm = new Vue({
            el: '#rrapp',
            data: {
                show: false,
                tableData: dataList,
                currentPage: 1,
                total: 500,
                listLoading: false,
                multipleSelection: [],
                form: {
                    scanCode: null,
                    invoiceNo: null,
                    invoiceCode: null,
                    invoiceDate: null,
                    invoiceAmount: null,
                    notCheckMsg: null,
                    checkCode: null
                },
                checkInvoiceDate: {}
            }, watch: {
                'form.invoiceNo': {
                    handler: function (val, oldValue) {
                        $('#requireMsg2 .checkMsg').remove();
                        var reg = /^[0-9]{0,}$/;

                        if (!(reg.test(val) || val == null)) {
                            Vue.nextTick(function () {
                                vm.form.invoiceNo = oldValue;
                            })
                        }
                    },
                    deep: true
                },
                'form.invoiceAmount': {
                    handler: function (val, oldValue) {
                        $('#requireMsg3 .checkMsg').remove();
                        $('#requireMsg5 .checkMsg').remove();
                        var reg;
                        if (getInvoiceType() == "14") {
                            reg = /^[0-9]{0,}$/;
                        } else if (getInvoiceType() == '01' || getInvoiceType() == '03') {
                            reg = /(^[0-9]{0,}\.{0,1}[0-9]{0,2}$)|(^-[0-9]{0,}\.{0,1}[0-9]{0,2}$)/;
                        } else {
                            reg = /(^[0-9]{0,}\.{0,1}[0-9]{0,2}$)|(^-[0-9]{0,}\.{0,1}[0-9]{0,2}$)/;
                        }

                        if (!(reg.test(val) || val == null)) {
                            Vue.nextTick(function () {
                                vm.form.invoiceAmount = oldValue;
                            })
                        }
                    },
                    deep: true
                },
                'form.invoiceCode': {
                    handler: function (val, oldValue) {

                        $('#requireMsg1 .checkMsg').remove();
                        var reg = /^[0-9]{0,}$/;

                        if (!(reg.test(val) || val == null)) {
                            Vue.nextTick(function () {
                                vm.form.invoiceCode = oldValue;
                            })
                        }

                        //判断发票类型是否改变
                        if (val != "" && val != null && oldValue != null) {

                            if (getFplx(oldValue) != getInvoiceType()) {
                                vm.form.invoiceAmount = "";
                            }
                        }
                        if (getInvoiceType() == "14") {
                            $("#requireMsg5").removeClass("hideItem");
                            $("#requireMsg3").addClass("hideItem");
                        } else {
                            $("#requireMsg3").removeClass("hideItem");
                            $("#requireMsg5").addClass("hideItem");
                        }

                    },
                    deep: true
                }
            },
            mounted: function () {
                $("#autofocusinput").focus();
                this.form.scanCode;
                this.form.invoiceNo;
                this.form.invoiceCode;
                this.form.invoiceDate;
                this.form.invoiceAmount;
                this.form.notCheckMsg;
                this.form.checkCode;
                this.checkInvoiceDate = {
                    disabledDate: function (time) {
                        return time.getTime() >= Date.now();
                    }
                };
            },

            methods: {
                focuspickerchange: function (val) {
                    if (val == 1) {
                        $('div.el-date-editor:first-child span.el-input__suffix').css('background', '#ffaa00');
                        $('div.el-date-editor:first-child span.el-input__prefix i').css('color', '#333333');
                    } else {
                        $('div.el-date-editor:first-child span.el-input__suffix').css('background', '#ffaa00');
                        $('div.el-date-editor:first-child span.el-input__prefix i').css('color', '#333333');
                    }
                },
                blurpickerchange: function (val) {
                    if (val == 1) {
                        $('div.el-date-editor:first-child span.el-input__suffix').css('background', 'white');
                        $('div.el-date-editor:first-child span.el-input__prefix i').css('color', '#ffaa00');
                    } else {
                        $('div.el-date-editor:first-child span.el-input__suffix').css('background', 'white');
                        $('div.el-date-editor:first-child span.el-input__prefix i').css('color', '#ffaa00');
                    }
                },
                invoiceAmountFormatDecimal: function (row) {
                    return decimal(row.invoiceAmount);
                },
                changeFun: function (row) {

                    this.multipleSelection = row;
                },
                checkboxInit: function (row, index) {

                    if (row.noAuthTip != '' && row.noAuthTip != null) {
                        return 0;
                    } else {
                        return 1;
                    }
                },
                formatInvoiceDate: function (row, column) {
                    if (row.invoiceDate != null) {
                        return dateFormat(row.invoiceDate);
                    } else {
                        return '';
                    }
                }
                , add: function () {
                    //01,10,011001700112,10113872,32,20180224,17602940807063740560,0819,
                    var scanCode = this.form.scanCode;
                    if (scanCode == null || scanCode == "" || scanCode == undefined) {

                    } else if (scanCode.split(",").length <= 6) {
                        return alert("发票类型不符！", function () {
                            vm.reset();
                        });
                    } else {
                        var code = scanCode.split(",");
                        var invoiceType = getFplx(code[2]);
                        if (invoiceType != '01' && invoiceType != '03' && invoiceType != '14') {
                            return alert("发票类型不符！", function () {
                                vm.reset();
                            });
                        } else {
                            var invoiceNo = code[3];
                            var invoiceCode = code[2];
                            var invoiceAmount = code[4];
                            var invoiceDate = code[5];
                            var checkCode = code[6].substring(code[6].length - 6);
                            if (invoiceDate.length == 8) {
                                var year = invoiceDate.substring(0, 4);
                                var month = invoiceDate.substring(4, 6);
                                var day = invoiceDate.substring(6);
                                invoiceDate = year + "-" + month + "-" + day;
                            }
                            var params = {
                                invoiceNo: invoiceNo,
                                invoiceCode: invoiceCode,
                                invoiceDate: invoiceDate,
                                invoiceAmount: invoiceAmount
                            };
                            $.get(baseURL + "certification/scanCheck/selectCheck", params, function (r) {
                                if (r.code == 0 && r.entity != null) {
                                    var data = {
                                        'uuid': true,
                                        'noAuthTip': checkValue(r.entity),
                                        'invoiceCode': r.entity.invoiceCode,
                                        'id': r.entity.id,
                                        'invoiceNo': r.entity.invoiceNo,
                                        'invoiceType': r.entity.invoiceType,
                                        'invoiceDate': r.entity.invoiceDate,
                                        'invoiceAmount': r.entity.invoiceAmount,
                                        'checkCode': r.entity.checkCode
                                    };
                                    if (currentIds.length > 0 && contains(currentIds, r.entity.id)) {
                                        return alert("此发票已扫码", function () {
                                            vm.reset();
                                        });
                                    }
                                    currentIds.push(r.entity.id);
                                    dataList.push(data);
                                    this.tableData = dataList;
                                    vm.reset();
                                } else if (r.code == 1) {
                                    var data = {
                                        'uuid': true,
                                        'noAuthTip': "无底账信息",
                                        'invoiceCode': invoiceCode,
                                        'id': invoiceCode + invoiceNo,
                                        'invoiceNo': invoiceNo,
                                        'invoiceType': getFplx(invoiceCode),
                                        'invoiceDate': invoiceDate,
                                        'invoiceAmount': invoiceAmount,
                                        'checkCode': checkCode
                                    };
                                    if (currentIds.length > 0 && contains(currentIds, invoiceCode + invoiceNo)) {
                                        return alert("请不要重复操作同一发票", function () {
                                            vm.reset();
                                        });
                                    }
                                    currentIds.push(invoiceCode + invoiceNo);
                                    dataList.push(data);
                                    this.tableData = dataList;
                                    vm.reset();

                                }

                            });
                        }
                    }
                },

                check: function () {

                    if (this.multipleSelection.length == 0) {
                        alert("您尚未选择需要提交勾选的发票!");
                        return;
                    }
                    var ids = [];
                    var select = this.multipleSelection;
                    for (var i = 0; i < select.length; i++) {
                        ids.push(select[i].id);
                    }
                    var idss = ids.join(",");
                    this.openConfirm(vm, '确定要勾选选中的记录？', function () {
                        $.ajax({
                            type: "GET",
                            url: baseURL + "certification/scanCheck/submit",
                            contentType: "application/json",
                            data: {ids: idss},
                            success: function (r) {
                                if (r.code != undefined && r.code != null && r.code == 500) {
                                    alert('提交勾选失败');
                                    return;
                                }
                                if (r) {
                                    vm.tableData = dataList.filter(function (item) {
                                        return !(contains(ids, item.id));
                                    });
                                    alert('提交勾选成功');
                                } else {
                                    alert('提交勾选失败');
                                }
                            }
                        });
                    }, function () {
                    });

                },
                reset: function () {
                    $("#requireMsg3").removeClass("hideItem");
                    $("#requireMsg5").addClass("hideItem");
                    $(".checkMsg").remove();
                    this.$refs.scanCode.focus();
                    this.form.invoiceNo = null;
                    this.form.invoiceCode = null;
                    this.form.invoiceDate = null;
                    this.form.invoiceAmount = null;
                    this.form.notCheckMsg = null;
                    this.form.checkCode = null;
                    this.form.scanCode = null;
                },
                invoiceDate: function (val) {
                    $('#requireMsg4 .checkMsg').remove();
                    this.form.invoiceDate = val;
                },

                save: function () {
                    $(".checkMsg").remove();
                    var checkCode = "";
                    if (getInvoiceType() == "14") {
                        checkCode = vm.form.invoiceAmount;
                    }
                    var params = {
                        invoiceNo: this.form.invoiceNo,
                        invoiceCode: this.form.invoiceCode,
                        invoiceDate: this.form.invoiceDate,
                        invoiceAmount: this.form.invoiceAmount,
                        checkCode: checkCode
                    };

                    var checkInvoiceCode = true;
                    var checkInvoiceNo = true;
                    var checkInvoiceAmount = true;
                    var checkInvoiceDate = true;

                    if (this.form.invoiceCode == null || this.form.invoiceCode == "" || this.form.invoiceCode == undefined) {

                        $("#requireMsg1 .el-form-item__content").append('<div class="checkMsg">发票代码不可为空</div>');
                        checkInvoiceCode = false;
                    }
                    if (this.form.invoiceNo == null || this.form.invoiceNo == "" || this.form.invoiceNo == undefined) {

                        $("#requireMsg2 .el-form-item__content").append('<div class="checkMsg">发票号码不可为空</div>');
                        checkInvoiceNo = false;
                    }
                    if (this.form.invoiceAmount == null || this.form.invoiceAmount == "" || this.form.invoiceAmount == undefined) {

                        $("#requireMsg3 .el-form-item__content").append('<div class="checkMsg">发票金额不可为空</div>');
                        checkInvoiceAmount = false;
                    }
                    if (this.form.invoiceAmount == null || this.form.invoiceAmount == "" || this.form.invoiceAmount == undefined) {

                        $("#requireMsg5 .el-form-item__content").append('<div class="checkMsg">验证码不可为空</div>');
                        checkInvoiceAmount = false;
                    }
                    if (this.form.invoiceDate == null || this.form.invoiceDate == "" || this.form.invoiceDate == undefined) {

                        $("#requireMsg4 .el-form-item__content div.el-date-editor:first-child").append('<div class="checkMsg">开票日期不可为空</div>');
                        checkInvoiceDate = false;
                    }
                    if (!(checkInvoiceCode && checkInvoiceNo && checkInvoiceAmount && checkInvoiceDate)) {
                        return;
                    }

                    var invoiceType = getFplx(this.form.invoiceCode);
                    if (invoiceType != '01' && invoiceType != '03' && invoiceType != '14') {
                        return alert("发票类型不符！", function () {
                            vm.reset();
                        });
                    }
                    $.get(baseURL + "certification/scanCheck/selectCheck", params, function (r) {
                        if (r.code == 0 && r.entity != null) {
                            var data = {
                                'uuid': true,
                                'noAuthTip': checkValue(r.entity),
                                'invoiceCode': r.entity.invoiceCode,
                                'id': r.entity.id,
                                'invoiceNo': r.entity.invoiceNo,
                                'invoiceType': r.entity.invoiceType,
                                'invoiceDate': r.entity.invoiceDate,
                                'invoiceAmount': r.entity.invoiceAmount,
                                'checkCode': r.entity.checkCode
                            };
                            if (currentIds.length > 0 && contains(currentIds, r.entity.id)) {
                                return alert("请不要重复操作同一发票", function () {
                                    vm.reset();
                                });
                            }
                            currentIds.push(r.entity.id);
                            dataList.push(data);
                            this.tableData = dataList;
                            vm.reset();
                        } else if (r.code == 1) {
                            var currentInvoiceCode = vm.form.invoiceCode;
                            var currentInvoiceNo = vm.form.invoiceNo;
                            var currentInvoiceAmount = vm.form.invoiceAmount;
                            var currentCheckCode = vm.form.invoiceAmount;
                            if (checkCode != "" && checkCode != null) {
                                currentInvoiceAmount = "";
                            } else {
                                currentCheckCode = "—— ——";
                            }

                            var data = {
                                'uuid': true,
                                'noAuthTip': "无底账信息",
                                'invoiceCode': currentInvoiceCode,
                                'id': currentInvoiceCode + currentInvoiceNo,
                                'invoiceNo': currentInvoiceNo,
                                'invoiceType': getInvoiceType(),
                                'invoiceDate': vm.form.invoiceDate,
                                'invoiceAmount': currentInvoiceAmount,
                                'checkCode': currentCheckCode
                            };
                            if (currentIds.length > 0 && contains(currentIds, currentInvoiceCode + currentInvoiceNo)) {
                                return alert("请不要重复操作同一发票", function () {
                                    vm.reset();
                                });
                            }
                            currentIds.push(currentInvoiceCode + currentInvoiceNo);
                            dataList.push(data);
                            this.tableData = dataList;
                            vm.reset();
                        }

                    });

                }

            }
        })
    ;

    /**
     * 根据发票代码获取发票类型
     *
     */
    function getFplx(fpdm) {
        var fpdmlist = ['144031539110', "131001570151", "133011501118", "111001571071"];
        var fplx = "";
        if (fpdm.length == 12) {

            var fplxflag = fpdm.substring(7, 8);
            for (var i = 0; i < fpdmlist.length; i++) {
                if (fpdm == fpdmlist[i]) {
                    fplx = "10";
                    break;
                }
            }
            if (fpdm.substring(0, 1) == "0" && fpdm.substring(10, 12) == "11") {
                fplx = "10";
            }
            if (fpdm.substring(0, 1) == "0" && fpdm.substring(10, 12) == "12") {
                fplx = "14";
            }
            if (fpdm.substring(0, 1) == "0" && (fpdm.substring(10, 12) == "06" || fpdm.substring(10, 12) == "07")) {
                //判断是否为卷式发票  第1位为0且第11-12位为06或07
                fplx = "11";
            }
            if (fplxflag == "2" && fpdm.substring(0, 1) != "0") {
                fplx = "03";
            }

        } else if (fpdm.length == 10) {
            var fplxflag = fpdm.substring(7, 8);
            if (fplxflag == "1" || fplxflag == "5") {
                fplx = "01";
            } else if (fplxflag == "6" || fplxflag == "3") {
                fplx = "04";
            } else if (fplxflag == "7" || fplxflag == "2") {
                fplx = "02";
            }

        }
        return fplx;
    }

    function contains(arr, obj) {
        var i = arr.length;
        while (i--) {
            if (arr[i] === obj) {
                return true;
            }
        }
        return false;
    }

    function checkValue(entity) {
        var date = new Date(entity.invoiceDate);
        var dqskssq = entity.currentTaxPeriod;

        if (dqskssq != null) {
            var year = dqskssq.substring(0, 4);
            var month = dqskssq.substring(4);
            dqskssq = new Date(year, month, "00");
        }

        var msg = null;
        if (entity.authStatus != "0" && entity.authStatus != "5") {
            return msg = "已在认证处理状态";
        } else if (!entity.taxAccess) {
            return msg = "没有税号权限";
        } else if (entity.invoiceStatus == "1") {
            return msg = "失控发票";
        } else if (entity.invoiceStatus == "2") {
            return msg = "作废发票";
        } else if (entity.invoiceStatus == "3") {
            return msg = "红冲发票";
        } else if (entity.invoiceStatus == "4") {
            return msg = "异常发票";
        } else if (entity.valid == "0") {
            return msg = "无效发票";
        } else if (entity.invoiceAmount <= 0) {
            return msg = "金额小于等于0";
        } else if (entity.taxAmount < 0) {
            return msg = "税额小于0";
        } else if (entity.rzhYesOrNo == "1") {
            return msg = "已认证";
        } else if (date < new Date('2017-01-01 00:00:00')) {
            return msg = "发票已逾期";
        } else if (date > dqskssq && dqskssq != null) {
            return msg = "开票日期不大于当前税款所属期";
        }
        return msg;

    }

    function addDay(dayNumber, date) {
        date = date ? date : new Date();
        var ms = dayNumber * (1000 * 60 * 60 * 24);
        var newDate = new Date(date.getTime() + ms);
        return newDate;
    }

    function dateFormat(value) {
        if (value == null) {
            return '';
        }
        return value.substring(0, 10);
    }

    function getInvoiceType() {
        var invoice = vm.form.invoiceCode;
        if (invoice != null && !undefined) {
            return getFplx(invoice)
        } else {
            return "";
        }
    }

    /**
     * 格式化货币 千分号和四舍五入保留两位小数
     * @param cellvalue
     * @param options
     * @param rowObject
     * @returns {*}
     */
    function decimal(cellvalue) {
        if (cellvalue != null) {
            var val = Math.round(cellvalue * 100) / 100;
            return val.formatMoney();
        }
        return "";
    }

    Number.prototype.formatMoney = function (places, symbol, thousand, decimal) {
        places = !isNaN(places = Math.abs(places)) ? places : 2;
        symbol = symbol !== undefined ? symbol : "";
        thousand = thousand || ",";
        decimal = decimal || ".";
        var number = this,
            negative = number < 0 ? "-" : "",
            i = parseInt(number = Math.abs(+number || 0).toFixed(places), 10) + "",
            j = (j = i.length) > 3 ? j % 3 : 0;
        return symbol + negative + (j ? i.substr(0, j) + thousand : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thousand) + (places ? decimal + Math.abs(number - i).toFixed(places).slice(2) : "");
    };

</script>
</body>
</html>