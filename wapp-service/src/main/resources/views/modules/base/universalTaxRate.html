
<!DOCTYPE html>
<html lang="ZH">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../libs/customer/index.css">
    <style scoped>
        .hide-dialog {
            display: none;
        }

        [v-cloak] {
            display: none;
        }

        #file {
            outline: 0.01rem;
            background-color: transparent;
            filter: alpha(opacity=0);
            -moz-opacity: 0;
            -khtml-opacity: 0;
            opacity: 0;
            height: 0.4rem;
            width: 100%;
        }

        .control-label {
            display: block;
            margin-bottom: 0.0rem;
            height: 0.35rem;
            line-height: 0.4rem;
            overflow: hidden;
        }

        #upload {
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            line-height: 0.4rem;
            border: 0.01rem solid #dedede;
            height: 0.4rem;
        }

        .row {
            padding: 0 !important;
        }
    </style>
</head>

<style type="text/css">

    .form-row {
        width: 98%;
        display: flex;
        flex-direction: row;
    }

    .form-item {
        width: 25%;
    }

    .el-dialog__body {
        padding: 0.15rem 0.2rem;
        border: 0.01rem solid #dcdfe6;
    }

    .el-dialog {
        width: 7.0rem;
    }

    .el-form-item {
        margin-bottom: 0.2rem;
    }

    .el-textarea {
        width: 5.0rem;
    }

    .input-class {
        -webkit-appearance: none;
        background-color: #fff;
        background-image: none;
        border: 0.01rem solid #dcdfe6;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        color: #606266;
        display: inline-block;
        font-size: inherit;
        height: 0.4rem;
        line-height: 0.4rem;
        outline: 0;
        padding: 0 0.15rem;
        -webkit-transition: border-color .2s cubic-bezier(.645, .045, .355, 1);
        transition: border-color .2s cubic-bezier(.645, .045, .355, 1);
        width: 100%;
    }

    .input-class:focus {
        border: 0.01rem solid #ffc653;
    }

    .colNew {
        padding-top: 0.1rem;
        border-radius: 0.04rem;
        border: 0.01rem solid #eee;
        border-bottom: none;
    }

    button span {
        font-size: 0.14rem !important;
    }
    .el-dialog__header{
        background: #333333;
        color: white;
    }
    .el-dialog__header span,.el-dialog__header i{
        color: white !important;
    }.el-dialog__body{
        overflow:hidden;
    }
</style>
<body>
<iframe id="ifile" style="display:none"></iframe>
<div id="universalTaxRate" v-cloak>
    <div id="appForm">
        <el-form  :model="taxForm" class="demo-form-inline" label-width="1.0rem">
            <el-row>
                <el-col :span="12">
                <el-form-item label="供应商号:">
                    <el-input v-model="taxForm.vendorNbr" placeholder="请输入供应商号" :maxlength="14"
                             ></el-input>
                </el-form-item>
                </el-col>
                <el-col :span="12">
                <el-form-item label="供应商名称:">
                    <el-input v-model="taxForm.vendorName" placeholder="请输入供应商名称" :maxlength="14"
                              ></el-input>
                </el-form-item>
                </el-col>
                <el-col :span="1" :offset="1">
                <el-button class="btnexport" @click="onSubmit">查询</el-button>
                </el-col>
                <!--<el-col :span="1" :offset="1">
                    <el-button class="btnexport" @click="doInvoiceCheckHistoryExport()" v-bind:disabled="exportButtonFlag">导出</el-button>
                </el-col>-->
            </el-row>
        </el-form>

        <form id="upload_form" target="frm" method="post" enctype="multipart/form-data">
            <div class="row" style="border-top: 0" >
                <div class="col-xs-3">
                    <div class="form-group">
                        <label class="col-xs-4 control-label">选择上传文件:</label>
                        <div class="col-xs-6" id="upload">
                            <span v-html="selectFileFlag"></span>
                            <input type="file" @change="onChangeFile($event)" id="file" name="file" class="text-input"
                                   hidden>
                        </div>
                    </div>
                </div>
                <el-col :span="1" :offset="1">
                    <el-button  class="btnexport" @click="showSelectFileWin()">浏览</el-button>
                </el-col>
                <el-col :span="1" :offset="1">
                    <el-button  class="btnexport" @click="uploadFile($event)" :loading="importLoading">导入文件</el-button>
                </el-col>
                <el-col :span="1" :offset="1">
                    <el-button  class="btnexport" @click="exportData()">模板下载</el-button>
                </el-col>
            </div>
            <iframe id="frm" name="frm" style="display: none;"></iframe>
        </form>
    </div>
    <hr>

    <el-table height="4rem" border fit :data="vendorData" highlight-current-row style="width: 100%;font-size: 0.12rem;"
              style="width: 100%; margin-top: 0.2rem"
              v-loading="loading"
              element-loading-text="正在拼命加载中"
    >
        <el-table-column :show-overflow-tooltip="true"  type="index" width="70" :index="mainIndex" label="序号" header-align="center" align="center">
        </el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="vendorNbr" label="供应商号" v-bind:show-overflow-tooltip="true"
                         align="center" header-align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="deptId" label="部门" align="center" header-align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="vendorName" label="供应商名称" align="left"
                         header-align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  label="操作" align="center">
            <template slot-scope="scope">
                <span style="margin-left: 0.1rem;cursor: pointer" @click="doCommodityDetail(scope.row)">查看</span>
                &nbsp;&nbsp;
                <span style="margin-left: 0.1rem;cursor: pointer" @click="deleteVendor(scope.row)">删除供应商</span>
            </template>



        </el-table-column>
    </el-table>

    <el-col class="toolbar" style="padding:0.1rem;">
        <el-pagination background @current-change="currentChange" @size-change="handleSizeChange"
                       :current-page="pageData.currentPage" :page-size="pageSize" :page-sizes="pageList"
                       :pager-count="pagerCount"
                       layout="slot, sizes, prev, pager, next" :total="total" style="float:right">
            <span>共{{total}}条记录，第{{pageData.currentPage}}页，共{{totalPage}}页</span>
        </el-pagination>
    </el-col>
    <!--弹框-->
    <el-dialog title="商品信息" :visible.sync="dialogTableVisible" width="75%" attr-class center :close-on-click-modal="false" >
        <el-form  :model="detailForm" class="demo-form-inline" label-width="1.0rem">
            <el-row>
                <el-col :span="15">
                    <el-form-item label="商品号:">
                        <el-input v-model="detailForm.itemNbr" onKeyUp="value=value.replace(/[\W]/g,'')" placeholder="请输入商品号"
                        ></el-input>
                    </el-form-item>
                </el-col>
                <el-col :span="15">
                    <el-form-item label="商品说明:">
                        <el-input v-model="detailForm.notes" placeholder="请输入商品说明"
                        ></el-input>
                    </el-form-item>
                </el-col>
                <el-col :span="1" :offset="1">
                    <el-button class="btnexport" @click="onSubmitDetail">查询</el-button>
                </el-col>
                <el-col :span="1" :offset="1">
                    <el-button class="btnexport" @click="addDetail">新增</el-button>
                </el-col>
                <el-col :span="1" :offset="1">
                    <el-button class="btnexport" @click="deleteCommodity">删除</el-button>
                </el-col>


            </el-row>
        </el-form>
        <el-table height="4rem" :data="commodityData" @selection-change="changeFun">
            <el-table-column :show-overflow-tooltip="true"  type="selection" width="55" align="center"></el-table-column>
            <el-table-column :show-overflow-tooltip="true"  type="index" width="80" :index="detailIndex" label="序号">
            </el-table-column>
            <el-table-column :show-overflow-tooltip="true"  property="itemNbr" label="商品号" v-bind:show-overflow-tooltip="true"
                             align="center" header-align="center"></el-table-column>
            <el-table-column :show-overflow-tooltip="true"  property="notes" label="商品描述" align="center" header-align="center"
                             v-bind:show-overflow-tooltip="true"></el-table-column>
            <el-table-column :show-overflow-tooltip="true"  property="inputTax" label="税率" align="center"
                             v-bind:show-overflow-tooltip="true" ></el-table-column>
        </el-table>

        <el-col class="toolbar" style="padding:0.1rem;">
            <el-pagination background @current-change="doCommodityDetailInPage" @size-change="handleDetailSizeChange"
                           :current-page="detailPageData.currentPage" :page-size="pageSize" :page-sizes="pageList"
                           :pager-count="pagerCount"
                           layout="slot, sizes, prev, pager, next" :total="detailPageData.total" style="float:right">
                <span>共{{detailPageData.total}}条记录，第{{detailPageData.currentPage}}页，共{{detailPageData.totalPage}}页</span>
            </el-pagination>
        </el-col>

    </el-dialog>

    <el-dialog :title="addOrUpdateForm.title" :visible.sync="addOrUpdateWin" :before-close="addOrUpdataWinClose"
               :close-on-click-modal="false"
               @close="clearValidate('addOrUpdateForm')">
        <el-form ref="addOrUpdateForm" :model="addOrUpdateForm" label-width="1.25rem">
            <div class="form-row">
                <el-form-item label="供应商号:">
                    <input class="input-class" style="width: 1.84rem;" readonly="readonly"
                           v-model.trim="addOrUpdateForm.vendorNbr">
                </el-form-item>
                <el-form-item label="供应商名称:">
                    <input class="input-class" style="width: 1.84rem;" readonly="readonly"
                           v-model.trim="addOrUpdateForm.vendorName">
                </el-form-item>
            </div>

            <div class="form-row">
                <el-form-item label="商品编号:" prop="itemNbr" :rules="[{ required: true, message: '商品编号不能为空'}]">
                    <input class="input-class" v-model.trim="addOrUpdateForm.itemNbr" maxlength="20">
                </el-form-item>
                <el-form-item label="商品说明:" prop="notes"
                              :rules="[{ required: true, message: '商品说明不能为空'}]">
                    <input class="input-class" v-model.trim="addOrUpdateForm.notes" maxlength="100">
                </el-form-item>
            </div>

            <div class="form-row">
                <el-form-item label="税率:" prop="inputTax" :rules="[{ required: true, message: '税率不能为空'}]">
                    <el-select v-model="addOrUpdateForm.inputTax" style="width: 2.02rem;!important;">
                        <el-option v-for="inputTax in itemsInputTax"
                                   :key="inputTax.value"
                                   :label="inputTax.text"
                                   :value="inputTax.value"></el-option>
                    </el-select>
                </el-form-item>


            </div>
        </el-form>

        <span slot="footer" class="dialog-footer">
            <el-button class="btnexport" @click="submitForm">保存</el-button>
        </span>
    </el-dialog>

</div>

</div>
</body>
<script type="text/javascript" charset="utf-8" src="../../js/customer/resource.js"></script>
<!--<script type="text/babel" src="../../js/modules/base/universalTaxRate.js"></script>-->
<script type="text/babel">
    var allDataList = [];
    var dataList = [];
    Vue.http.options.emulateJSON = true;
    Vue.http.options.emulateHTTP = true;
    var vm = new Vue({
        el: '#universalTaxRate',
        i18n,
        data: {
            importLoading : false,
            selectFileFlag: '',
            fileList: [],
            importFileUrl: '',
            vendorData: [],
            tableData: [],
            tempTableData: [],
            multipleSelection: [],
            taxForm: {
                vendorNbr: '',
                vendorName: ''
            },
            pageData: {
                currentPage: 1,
                total: 0,
            },
            dialogTableVisible: false,
            dialogDetailVisible:false,
            addOrUpdateWin:false,
            commodityData: [],
            detailRow: {},
            detailPageData: {
                currentPage: 1,
                total: 0,
                totalPage: 0
            },
            pagerCount: PAGE_PARENT.PAGER_COUNT,
            total: 0,
            totalPage: 0,
            pageList: PAGE_PARENT.PAGE_LIST,
            pageSize: PAGE_PARENT.PAGE_SIZE,
            exportButtonFlag: true, //导出按钮默认禁用
            loading: false,
            reg: /^[0-9]*$/,
            exportParam:{},
            detailEntityList: [],
            tempDetailEntityList: [],
            tempValue: null,
            detailForm: {
                itemNbr:'',
                notes:''
            },
            addOrUpdateForm: {
                itemNbr:'',
                notes:'',
                inputTax:null

            },
            addParams:{},
            isNeedFileExtension: false,
            file: "",
            token: token,
            itemsInputTax: [
                {text: '3%', value: '3'},
                {text: '5%', value: '5'},
                {text: '6%', value: '6'},
                {text: '9%', value: '9'},
                {text: '10%', value: '10'},
                {text: '13%', value: '13'},
                {text: '16%', value: '16'}
            ]
        },
        mounted: function () {
            this.importFileUrl = baseURL + sysUrl.importCertification;
        },
        watch: {
            'taxForm.vendorNbr': {
                handler: function (val, oldValue) {
                    var _this = this;
                    var reg = /^[0-9]{0,6}$/;
                    if (!(reg.test(val) || val == null)) {
                        Vue.nextTick(function () {
                            _this.taxForm.vendorNbr = oldValue;
                        })
                    }
                },
                deep: true
            }
        },
        methods: {

            exportData() {
                document.getElementById("ifile").src = baseURL + "export/commodityTemplate";
            },


            onChangeFile: function (event) {
                const str = $("#file").val();
                const index = str.lastIndexOf('.');
                var photoExt = str.substr(index, 4);
                photoExt = photoExt.toLowerCase();
                if (photoExt != '' && !(photoExt == '.xls' || photoExt == '.xlsx')) {
                    alert("请上传excel文件格式!");
                    this.isNeedFileExtension = false;
                    return false;
                } else {
                    this.selectFileFlag = '';
                    this.file = '';
                    var meFile = event.target.files[0];
                    if (event != undefined && meFile != null && meFile != '') {
                        this.file = event.target.files[0];
                        this.isNeedFileExtension = true;
                        //截取名称最后18位
                        this.selectFileFlag = event.target.files[0].name;
                    }
                }
            },

            deleteCommodity: function () {
                var ids = getSelectedRows();
                if (ids == null) {
                    return;
                }

                confirm('确定要删除选中的记录？', function () {
                    $.ajax({
                        type: "POST",
                        url: baseURL + "base/deleteCommodity",
                        contentType: "application/json",
                        data: JSON.stringify(ids),
                        success: function (r) {
                            if (r.code == 0) {
                                vm.multipleSelection = [];
                                vm.doCommodityDetailInPage(1);
                                alert('删除成功');
                            } else if (r.code == 401) {
                                alert("登录超时，请重新登录", function () {
                                    var hostHref = parent.location.href;
                                    if(hostHref.indexOf("int")!=-1){
                                        parent.location.href ="http://rl.wal-mart.com";
                                    }else if(hostHref.indexOf("ext")!=-1){
                                        parent.location.href ="https://retaillink.wal-mart.com";
                                    }else if(hostHref.indexOf("https://cnwapp.wal-mart.com")!=-1){
                                        parent.location.href ="https://retaillink.wal-mart.com";
                                    }else{
                                        parent.location.href = baseURL + 'login.html';
                                    }
                                });
                            } else {
                                alert(r.msg);
                            }
                        }
                    });
                });
            },

            uploadFile: function (event) {
                if (!this.isNeedFileExtension) {
                    alert("请上传excel文件格式!");
                } else {
                    event.preventDefault();
                    if (this.file == '' || this.file == undefined) {
                        alert("请选择excel文件!");
                        return;
                    }
                    vm.importLoading = true;
                    allDataList=[];
                    const formData = new FormData();
                    formData.append('file', this.file);
                    formData.append('token', this.token);
                    const config = {
                        headers: {
                            'Content-Type': 'multipart/form-data'
                        }
                    };
                    this.tempTableData = this.tableData;
                    this.tableData = [];
                    this.listLoading = true;
                    var flag = false
                    var hh;
                    const url = baseURL + "modules/base/commodityImport";
                    this.$http.post(url, formData, config).then(function (response) {
                        this.listLoading = false;

                        flag = true;
                        if(response.data.code !=undefined && response.data.code == 401) {
                            return;
                        }
                        this.selectFileFlag = '';
                        this.file = '';
                        vm.importLoading = false;
                        if (response.data.success) {
                           /* if (this.tempTableData.length + response.data.reason.length + response.data.errorCount > 500) {
                                this.tableData = this.tempTableData;
                                alert('导入数据超过500条，请修改模板！');
                                return;
                            }*/
                            for (var i = 0; i < response.data.reason.length; i++) {
                                if (dataList.length > 0 && this.contains(dataList, response.data.reason[i].invoiceCode + response.data.reason[i].invoiceNo)) {
                                    response.data.reason[i].noAuthTip = "0";
                                    allDataList.push(response.data.reason[i])
                                } else {
                                    dataList.push(response.data.reason[i].invoiceCode + response.data.reason[i].invoiceNo);
                                    allDataList.push(response.data.reason[i])
                                }
                            }
                            this.tableData = allDataList;
                            vm.getTaxCommondity(1);
                            alert("共计导入" + ((response.data.reason.length - response.data.errorCount) + response.data.errorCount) + "条，成功" + (response.data.reason.length - response.data.errorCount) + "条,失败" + response.data.errorCount + "条");
                        } else {
                            this.tableData = this.tempTableData;
                            alert(response.data.reason);
                        }
                    }, (err) => {
                        this.tableData = this.tempTableData;
                        this.listLoading = false;
                        if (err.status == 408) {
                            alert(err.statusText);
                        }
                    })
                    var intervelId = setInterval(function () {
                        if (flag) {
                            hh=$(document).height();
                            $("body",parent.document).find("#myiframe").css('height',hh+'px');
                            clearInterval(intervelId);
                            return;
                        }
                    },50);
                }
            },
            deleteVendor: function(row){
                var params={
                    vendorNbr:row.vendorNbr
                }
                confirm('确定要删除供应商吗？', function () {
                    $.ajax({
                        type: "POST",
                        url: baseURL + "base/vendorNbr",
                        contentType: "application/json",
                        data: JSON.stringify(params),
                        success: function (r) {

                            if (r.code == 0) {
                                alert('已确定删除供应商' );
                                vm.getTaxCommondity(vm.currentPage);
                            }else if (r.code == 401) {
                                alert("登录超时，请重新登录", function () {
                                    var hostHref = parent.location.href;
                                    if(hostHref.indexOf("int")!=-1){
                                        parent.location.href ="http://rl.wal-mart.com";
                                    }else if(hostHref.indexOf("ext")!=-1){
                                        parent.location.href ="https://retaillink.wal-mart.com";
                                    }else if(hostHref.indexOf("https://cnwapp.wal-mart.com")!=-1){
                                        parent.location.href ="https://retaillink.wal-mart.com";
                                    }else{
                                        parent.location.href = baseURL + 'login.html';
                                    }
                                });
                            } else {
                                alert("数据加载失败，请重试！");
                            }
                        }
                    });
                });

            },
            fileStatusChange: function (file, fileList) {
                this.fileList = fileList.slice(-1);
                if (file.status == 'ready') {
                    this.selectFileFlag = file.name;
                    this.file = file.raw;
                    const index = file.name.lastIndexOf('.');
                    const photoExt = file.name.substr(index, 4);
                    this.fileExt = photoExt.toLowerCase();
                }
            },
            showSelectFileWin() {
                this.selectFileFlag = '';
                this.file = '';
                $("#upload_form")[0].reset();
                $("#file").click();
            },
            contains: function (arr, obj) {
                var i = arr.length;
                while (i--) {
                    if (arr[i] === obj) {
                        return true;
                    }
                }
                return false;
            },

           /* showInner: function () {
                this.detailDialogFormInnerVisible = true;
            }
            ,
            detailInnerFormCancel: function () {
                this.detailDialogFormInnerVisible = false;
            }
            ,
            detailCheckInnerFormCancel: function () {
                this.detailDialogCheckFormInnerVisible = false;
            },*/

            getTaxCommondity: function (currentPage) {

                if (!isNaN(currentPage)) {
                    this.pageData.currentPage = currentPage;
                }
                var params = {};
                params.vendorNbr = Trim(this.taxForm.vendorNbr);
                params.vendorName = Trim(this.taxForm.vendorName);
                params.page = this.pageData.currentPage;
                params.limit = this.pageSize;
                params.sidx = "wtf";
                params.order = "desc";
                //this.exportParam = params;
                vm.loading = true;
                var flag = false;
                var hh;
                $.ajax({
                    url: baseURL + "modules/base/getVendor", async: true, type: "POST", dataType: "json",
                    data: params,
                    success: function (results) {
                        flag = true;
                        if (results.code == 0) {
                            var resultString = results.page;

                            /* if (resultString.totalCount > 0) {
                                 vm.exportButtonFlag = false; //查询结果大于0
                             } else {
                                 vm.exportButtonFlag = true;
                             }*/
                            vm.pageData.total = resultString.totalCount;
                            vm.total = resultString.totalCount;
                            vm.totalPage = resultString.totalPage;
                            vm.vendorData = [];
                            $.each(resultString.list, function (index, element) {
                                vm.vendorData.push(element);
                            });

                            vm.loading = false;
                        } else {
                            if (results.code != 401) {
                                parent.layer.alert(results.msg);
                            }
                            vm.loading = false;
                        }
                    }

                });
                var intervelId = setInterval(function () {
                    if (flag) {
                        hh = $(document).height();
                        $("body", parent.document).find("#myiframe").css('height', hh + 'px');
                        clearInterval(intervelId);
                        return;
                    }
                }, 50);
            },

            doCommodityDetail: function (row) {
                vm.dialogTableVisible = true;
                if (row != null) {
                    vm.detailRow.vendorNbr = row.vendorNbr;
                    vm.detailRow.vendorName = row.vendorName;
                    vm.detailRow.deptId = row.deptId;
                }
                var params = {};
                params.page = this.detailPageData.currentPage;
                params.limit = this.pageSize;
                params.vendorNbr = vm.detailRow.vendorNbr;
                params.vendorName = vm.detailRow.vendorName;
                params.deptId = vm.detailRow.deptId;
                params.itemNbr = Trim(this.detailForm.itemNbr);
                params.notes =  Trim(this.detailForm.notes);
                params.sidx = "wtf";
                params.order = "desc";

                vm.addParams = params;
                $.ajax({
                    url: baseURL + "modules/base/getCommodity", async: true, type: "POST", dataType: "json",
                    data: params,
                    success: function (results) {
                        var resultString = results.page;
                        vm.detailPageData.total = resultString.totalCount;
                        //vm.total = resultString.totalCount;
                        vm.detailPageData.totalPage = resultString.totalPage;
                        vm.commodityData = [];
                        $.each(resultString.list, function (index, element) {
                            vm.commodityData.push(element);
                        });

                    }
                });
            },

            doCommodityDetailInPage: function (currentPage) {
                if (!isNaN(currentPage)) {
                    this.detailPageData.currentPage = currentPage;
                }
                var params = {};
                params.page = this.detailPageData.currentPage;
                params.limit =this.pageSize;
                params.vendorNbr = vm.detailRow.vendorNbr;
                params.vendorName = vm.detailRow.vendorName;
                params.deptId = vm.detailRow.deptId;
                params.sidx = "wtf";
                params.order = "desc";
                $.ajax({
                    url: baseURL + "modules/base/getCommodity", async: true, type: "POST", dataType: "json",
                    data: params,
                    success: function (results) {
                        var resultString = results.page;
                        vm.detailPageData.total = resultString.totalCount;
                        vm.detailPageData.totalPage = resultString.totalPage;
                        vm.commodityData = [];
                        $.each(resultString.list, function (index, element) {
                            vm.commodityData.push(element);
                        });

                    }
                });
            },

            addDetail: function () {
                this.addOrUpdateForm.vendorNbr = this.addParams.vendorNbr;
                this.addOrUpdateForm.vendorName = this.addParams.vendorName;
                this.addOrUpdateForm.deptId = this.addParams.deptId;
                this.addOrUpdateForm.title = "新增商品信息";
                this.addOrUpdateWin = true;

            },

            saveData: function () {

                var data = vm.addOrUpdateForm;
                $.ajax({
                    type: "POST",
                    url: baseURL + "base/saveCommodity",
                    contentType: "application/json",
                    data: JSON.stringify(data),
                    success: function (r) {
                        if (r.code === 0) {
                            vm.addOrUpdateWin = false;
                            vm.doCommodityDetailInPage(1);
                            alert('新增成功');

                        } else if (r.code == 401) {
                            alert("登录超时，请重新登录", function () {
                                var hostHref = parent.location.href;
                                if(hostHref.indexOf("int")!=-1){
                                    parent.location.href ="http://rl.wal-mart.com";
                                }else if(hostHref.indexOf("ext")!=-1){
                                    parent.location.href ="https://retaillink.wal-mart.com";
                                }else if(hostHref.indexOf("https://cnwapp.wal-mart.com")!=-1){
                                    parent.location.href ="https://retaillink.wal-mart.com";
                                }else{
                                    parent.location.href = baseURL + 'login.html';
                                }
                            });
                        } else {
                            alert(r.msg);
                        }
                    }
                });
            },

            handleDetailSizeChange: function (val) {
                this.pageSize = val;
                this.doCommodityDetailInPage(1);
            },
            onSubmit: function () {
                this.getTaxCommondity();
            },
            onSubmitDetail: function () {
                this.doCommodityDetail();
            },
            submitForm: function () {
                //表单校验
                this.$refs['addOrUpdateForm'].validate(function (valid) {
                    if (valid) {
                        vm.saveData();
                    } else {
                        return false
                    }
                })
            },
            handleSizeChange: function (val) {
                this.pageSize = val;
                if (vm.pageData.total > 0) {
                    this.getInvoiceCheckHistory(1);
                }
            },
            currentChange: function (val) {
                if (vm.pageData.total > 0) {
                    this.getInvoiceCheckHistory(val);
                }
            },

            clearValidate: function (formName) {
                //移除整个表单的校验结果
                this.$refs[formName].clearValidate();
                this.addOrUpdateReset();
            },
            addOrUpdateReset: function () {
                //重置商品信息
                this.addOrUpdateForm.itemNbr = this.addParams.itemNbr;
                this.addOrUpdateForm.notes = this.addParams.notes;
                this.addOrUpdateForm.inputTax = this.addParams.inputTax;
            },

            addOrUpdataWinClose: function (val) {
                this.addOrUpdateWin = false;
            },
            /**
             * 事件 - 表格选中改变事件
             */
            changeFun: function (selection) {
                this.multipleSelection = selection;
            },

            /**
             * 行号 - 主列表
             */
            mainIndex: function (index) {
                return index + (this.pageData.currentPage - 1) * this.pageSize + 1;
            },
            /**
             * 行号 - 明细
             */
            detailIndex: function (index) {
                return index + (this.detailPageData.currentPage - 1) * this.pageSize + 1;
            }

        }
    });

    /***************选择多条记录******************/
    function getSelectedRows() {
        var selection = vm.multipleSelection;

        if (selection.length == 0) {
            alert("请选择要操作的记录");
            return;
        }

        var ids = [];
        for (var i = 0; i < selection.length; i++) {
          ids.push(selection[i].id);
        }

        return ids;
    }

    function Trim(str) {
        if (str != null) {
            return str.replace(/(^\s*)|(\s*$)/g, "");
        }
    }

    function TrimLength(o) {
        if (typeof (o) != "undefined" && o != null) {
            if (!isNaN(o)) {
                return o.replace(/(^\s*)|(\s*$)/g, "").length == 0;
            }
        } else {
            return true;
        }

    }
</script>
</html>