
<!DOCTYPE html>
<html lang="ZH">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" charset="utf-8" src="../../js/customer/resource.js"></script>
    <link rel="stylesheet" href="../../libs/customer/index.css">
    <style type="text/css">


        .date_margin {
            margin: 0 0.27rem;
        }

        .export_class {
            height: 0.35rem;
            width: 0.8rem;
            float: right;
        }

        .image_content {
            display: inline-block;
            width: 60%;
            margin-left: 2%;
            height: 5.0rem;
        }

        .form_content {
            float: right;
            display: inline-block;
            margin-right: 8%;
        }

        /*.image_content_area {
            height: 5.0rem;
        }*/

        .btn_default {
            border: 0.01rem solid #FFAA00;
            background: white;
            color: #ffaa00;
            border-radius: 0.02rem;
            cursor: pointer;
            font-family: PingFangSC-Regular;
            font-size: 0.16rem;
            letter-spacing: -0.0039000000000000003rem;
            outline: none
        }

        .btn_default:hover {
            background: #FFAA00;
            color: #333333;
        }

        .query_search_btn {
            height: 0.35rem;
            width: 0.8rem;
        }

        .el-input__suffix {
            right: 0;
        }

        .el-input--prefix .el-input__inner {
            padding-left: 0.15rem;
        }

        .el-select .el-input.is-focus .el-input__inner {
            border-color: #dcdfe6;
        }

        .no_image {
            font-size: 4em;
            color: #DDDDDD;
            margin-top: 20%;
            margin-left: 25%;
        }

        .export_class.is_disabled {
            color: #c0c4cc;
            cursor: not-allowed;
            background-image: none;
            background-color: #fff;
            border-color: #ebeef5;
        }

        .click_date {
            color: #333333;
        }

        .focus_date_bg {
            background-color: #ffaa00;
        }
        .el-date-editor.el-input{
            width: 100%;
        }
        .btnexport {
            /*width: 0.8rem;*/
            padding: 0 0.25rem;
            border-color: #ffaa00 !important;
            border-radius: 0.02rem !important;
            color: #ffaa00 !important;
            text-align: center !important;
            line-height: 0.3rem !important;
            margin-top: 0.04rem !important;
        }
        .el-button:focus {
            background-color: white;
        }
        .el-form-item.is-success .el-input__inner, .el-form-item.is-error .el-input__inner {
            border-color: #dcdfe6;
        }
        .label-success{
             background-color: #FFAA00 !important;
             color: #333333 !important;
         }
        /*media*/
        .el-col-2{
            width: 8%;
        }/*日期控件中间的—*/
        .el-col-3{
            width: 5%;
        }/*查询条件按钮（暂定）*/
        .el-col-4{
            width: 7%;
        }
        .el-col-12{
            width: 18%;
        }/*一般查询条件框*/
        .el-col-14{
            width: 38%;
        }/*日期查询框*/
        .el-col-13{
            width:46%;
        }/*日期查询框内单个日期控件*/
        .el-col-offset-1{
            margin-left: 1%;
            /*间距值*/
        }
        .el-col-15{
            width: 32%;
        }
        <!--@media screen and (max-width: 16.6rem) {-->
            <!--.el-col-2{-->
                <!--width: 8%;-->
            <!--}/*日期控件中间的—*/-->
            <!--.el-col-3{-->
                <!--width: 5%;-->
            <!--}/*查询条件按钮（暂定）*/-->
            <!--.el-col-4{-->
                <!--width: 7%;-->
            <!--}-->
            <!--.el-col-12{-->
                <!--width: 18%;-->
            <!--}/*一般查询条件框*/-->
            <!--.el-col-14{-->
                <!--width: 38%;-->
            <!--}/*日期查询框*/-->
            <!--.el-col-13{-->
                <!--width:46%;-->
            <!--}/*日期查询框内单个日期控件*/-->
            <!--.el-col-offset-1{-->
                <!--margin-left: 1%;-->
                <!--/*间距值*/-->
            <!--}-->
            <!--.el-col-15{-->
                <!--width: 32%;-->
            <!--}-->

        <!--}@media screen and (max-width: 11.8rem) {-->
            <!--/*.el-col-2{-->
                <!--width: 8%;-->
            <!--}!*日期控件中间的—*!-->
            <!--.el-col-3{-->
                <!--width: 15%;-->
            <!--}!*查询条件按钮（暂定）*!-->
            <!--.el-col-12{-->
                <!--width: 33%;-->
            <!--}!*一般查询条件框*!-->
            <!--.el-col-14{-->
                <!--width: 50%;-->
            <!--}!*日期查询框*!-->
            <!--.el-col-13{-->
                <!--width:36%;-->
            <!--}!*日期查询框内单个日期控件*!-->
            <!--.el-col-offset-1{-->
                <!--!*width值为4.16667%*!-->
            <!--}-->
            <!--.el-select{-->
                <!--width: 100%;-->
            <!--}*/-->
            <!--.el-form&#45;&#45;inline .el-form-item__label, .el-form-item__label {-->
                <!--font-size: 0.15rem !important;-->
                <!--letter-spacing: -0.01rem !important;-->
            <!--}-->
            <!--.el-input__inner{-->
                <!--height: 0.3rem;-->
            <!--}-->
            <!--.grid-content span{-->
                <!--font-size: 0.16rem;-->
            <!--}-->
            <!--.el-input__suffix {-->
                <!--width: 0.3rem;-->
                <!--height: 0.3rem;-->
                <!--top:0.05rem;-->
                <!--line-height: 0.3rem;-->
                <!--font-size: 0.16rem;-->
            <!--}-->
            <!--.el-input__prefix{-->
                <!--right: 0.02rem;-->
            <!--}-->

            <!--.btnexport{-->
                <!--padding: 0 0.17rem;-->
                <!--font-size: 0.13rem;-->
                <!--line-height: 0.24rem !important;-->
                <!--margin-top: 0.06rem !important;-->
            <!--}-->
            <!--.el-dialog__body td span,.el-dialog__body td{-->
                <!--font-size: 0.12rem !important;-->
            <!--}-->
            <!--.col-xs-9 span{-->
                <!--font-size: 0.12rem;-->
            <!--}-->
            <!--.el-dialog__body .col-xs-9>div span{-->
                <!--white-space: nowrap;-->
            <!--}-->
        <!--}-->
        .el-pagination__sizes>.el-select>div:first-child span.el-input__suffix{
            top:0
        }
        <!--@media screen and (max-width: 11.06rem) {-->
            <!--/*.el-col-2{-->
                <!--width: 10%;-->
            <!--}!*日期控件中间的—*!-->
            <!--.el-col-3{-->
                <!--width: 100%;-->
            <!--}!*查询条件按钮（暂定）*!-->
            <!--.el-col-12{-->
                <!--width: auto;-->
            <!--}!*一般查询条件框*!-->
            <!--.el-col-14{-->
                <!--width: 100%;-->
            <!--}!*日期查询框*!-->
            <!--.el-col-13{-->
                <!--width:45%;-->
            <!--}!*日期查询框内单个日期控件*!-->
            <!--.el-col-offset-1{-->
                <!--margin-left: 0.0rem;-->
                <!--!*width值为4.16667%*!-->
            <!--}-->
            <!--.el-select{-->
                <!--width: 100%;-->
            <!--}*/-->
            <!--.el-col-3{-->
                <!--width: 6%;-->
            <!--}/*查询条件按钮（暂定）*/-->
            <!--.el-col-4{-->
                <!--width: 9%;-->
            <!--}-->
            <!--.el-form&#45;&#45;inline .el-form-item__label, .el-form-item__label {-->
                <!--font-size: 0.14rem !important;-->
                <!--letter-spacing: -0.0143rem !important;-->
            <!--}-->
            <!--.el-input__inner{-->
                <!--height: 0.26rem;-->
            <!--}-->
            <!--.grid-content span{-->
                <!--font-size: 0.15rem;-->
            <!--}-->
            <!--.el-input__suffix {-->
                <!--width: 0.26rem;-->
                <!--height: 0.26rem;-->
                <!--top:0.07rem;-->
                <!--line-height: 0.26rem;-->
                <!--font-size: 0.15rem;-->
            <!--}-->
            <!--.el-input__prefix{-->
                <!--right: 0;-->
            <!--}-->
            <!--.el-icon-date{-->
                <!--font-size: 0.16rem;-->
            <!--}-->
            <!--.btnexport{-->
                <!--padding: 0 0.12rem;-->
                <!--font-size: 0.12rem;-->
                <!--line-height: 0.24rem !important;-->
                <!--margin-top: 0.08rem !important;-->
            <!--}-->
            <!--.el-row > div:first-child .el-select input {-->
                <!--padding-right: 0.07rem !important;-->
                <!--padding-left: 0.01rem !important;-->
            <!--}-->
            <!--.el-input{-->
                <!--font-size: 0.12rem;-->
            <!--}-->
            <!--th, thead {-->
                <!--font-size: 0.14rem !important;-->
            <!--}-->
            <!--.el-dialog__body .col-xs-9>div:last-child span{-->
                <!--white-space: nowrap;-->
            <!--}-->
        <!--}-->

        /*兼容ie11样式*/
        <!--@media screen and (-ms-high-contrast:active),(-ms-high-contrast:none) and (max-width:11.8rem) {
            .el-input__suffix {
                top:0.03rem;
            }
            .el-input__prefix{
                top:-0.05rem;
            }
            input{
                line-height: 0.3rem !important;
            }
        }-->
    </style>
</head>
<body>
<iframe id="ifile" style="display:none"></iframe>
<div id="rrapp" v-cloak>
    <el-form ref="invoice" :model="invoice" label-width="1.0rem">
        <el-row>
            <el-col :span="12">
                <el-form-item label="购方名称:" class="form-item">
                    <el-select v-model="invoice.gfTaxNo" id="gfSelect" placeholder="请选择购方名称" filterable @focus="gfNameFocus" @blur="gfNameBlur">
                        <el-option
                                v-for="item in options"
                                :key="item.orgTaxNo"
                                :label="item.orgName"
                                :value="item.orgTaxNo">
                        </el-option>
                    </el-select>
                </el-form-item>
            </el-col>
            <el-col :span="12">
                    <el-form-item label="发票号码:" class="form-item">
                        <el-input placeholder="请输入发票号码" v-model="invoice.invoiceNo" maxlength="8"></el-input>
                    </el-form-item>
            </el-col>
            <el-col :span="14">
                    <el-form-item label="签收时间:" class="form-item" id="requireMsg4">
                        <el-row>
                        <el-col :span="13">
                            <el-date-picker type="date" :clearable="false" :editable="false"
                                            :picker-options="qsStartDateOptions" id="qsStartDate"
                                            @blur="removeDateStyle(1)"
                                            @focus="addDateStyle(1)" format="yyyy-MM-dd" value-format="yyyy-MM-dd"
                                            start-placeholder="选择签收开始日期" v-model="invoice.qsStartDate"></el-date-picker>
                        </el-col>
                        <el-col :span="2">—</el-col>
                        <el-col :span="13">
                            <el-date-picker type="date" :clearable="false" :editable="false"
                                            :picker-options="qsEndDateOptions" id="qsEndDate"
                                            @blur="removeDateStyle(2)"
                                            @focus="addDateStyle(2)" format="yyyy-MM-dd" value-format="yyyy-MM-dd"
                                            end-placeholder="选择签收结束日期" v-model="invoice.qsEndDate"></el-date-picker>
                        </el-col>
                        </el-row>
                    </el-form-item>
            </el-col>
            <el-col :span="1" :offset="1">
                <el-button class="btnexport" type="button" @click="reloadInvoice">查询</el-button>
            </el-col>
            <el-col :span="1" :offset="1">
                <el-button class="btnexport is_disabled" id="exportBtn"  v-bind:disabled="exportButtonFlag" @click="exportElectronInvoice">导出</el-button>
            </el-col>
        </el-row>
    </el-form>
    <hr>
    <div>
        <div align="left" style="float:left;font-size: 0.18rem; margin-top:0.09rem"><span id="totalStatistics"></span></div>
    </div>
    <el-table height="4rem" :stripe="true" :data="listData" border fit highlight-current-row
              v-loading="listLoading" element-loading-text="正在拼命加载中" style="width: 100%; margin-top: 0.2rem">
        <el-table-column :show-overflow-tooltip="true"  type="index" width="70" :index="mainIndex" label="序号" align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="qsStatus" label="签收状态" align="center" :formatter="formatterQsStatus"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="qsType" label="签收方式" align="left" header-align="center" :formatter="formatterQsType"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="invoiceCode" label="发票代码" align="left" header-align="center"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="invoiceNo" label="发票号码" align="left" header-align="center">
            <template scope="scope">
                <span>{{ scope.row.invoiceNo }}</span>
                <el-tooltip class="item" effect="dark" placement="top-start">
                    <div slot="content" v-if="scope.row.invoiceType== '10' ">增值税电子普通发票</div>
                    <img  v-if="scope.row.invoiceType== '10'"  style="height:0.2rem;" src="../../img/einvoice.png" />
                    <div slot="content" v-if="scope.row.invoiceType== '14' ">增值税电子普通发票（通行费）</div>
                    <img  v-if="scope.row.invoiceType== '14' " style="height:0.2rem;" src="../../img/general-invoice.png" />
                </el-tooltip>
            </template>
        </el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="invoiceDate" label="开票日期" align="center" :formatter="formatterKprq"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="invoiceAmount" label="金额" align="right" header-align="center" :formatter="numberFormat"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="taxAmount" label="税额" align="right" header-align="center" :formatter="numberFormat"></el-table-column>
        <el-table-column :show-overflow-tooltip="true"  property="id" label="操作" class-name="noSpotSpotSpot" class-name="noSpotSpotSpot" align="center" header-align="center" width="180">
            <template scope="scope">
               <span v-if="scope.row.scanId != null">
                   <a @click="showImageWin(scope.$index, scope.row)">图片</a>
               </span>
                <span v-else>
                    <a style="color: #c0c4cc;text-decoration: none;cursor:not-allowed;">图片</a>
                </span>
                <span v-if="scope.row.qsStatus == 0">
                   <a @click="showUpdateWin(scope.$index, scope.row)" style="margin: 0 0.06rem;">修改</a>
               </span>
                <span v-else>
                    <a style="color: #c0c4cc;text-decoration: none;cursor:not-allowed;margin: 0 0.06rem;">修改</a>
                </span>
                <span>
                    <a @click="deleteInvoice(scope.$index, scope.row)">删除</a>
                </span>

            </template>
        </el-table-column>
    </el-table>
    <el-col class="toolbar" style="padding:0.1rem;">

        <el-pagination layout="slot, sizes,prev,pager,next" background
                       :current-page.sync="currentPage" :page-size="pageSize" :total="total" :page-size="pageSize" :page-sizes="pageList" @size-change="handleSizeChange"
                       :page-count="pageCount" @current-change="currentChange" style="float:right">
        </el-pagination>
        <span style="float: right;margin-top: 0.4%">共{{total}}条记录，第{{currentPage}}页，共{{pageCount}}页</span>

    </el-col>

    <el-dialog title="修改" :visible.sync="updateWinShow" :close-on-click-modal="false" :before-close="beforeCloseUpdateWin" @close="" width="80%">
        <div class="image_content">
            <img id="edit_image_area" v-show="haveImageShow" style="padding: 0.3rem 0; width: 100%" src="">
            <div class="no_image" v-show="noImageShow">
                手工录入无图片
            </div>
        </div>
        <div class="form_content">
            <el-form ref="updateInvoice" :model="updateInvoice" label-width="1.0rem">
                <el-form-item label="发票代码:" class="form-item" prop="invoiceCode" :rules="[{ required: true, message: '发票代码不能为空'}]">
                    <el-input :disabled="true" v-model="updateInvoice.invoiceCode"></el-input>
                </el-form-item>
                <el-form-item label="发票号码:" class="form-item" prop="invoiceNo" :rules="[{ required: true, message: '发票号码不能为空'}]">
                    <el-input :disabled="true" v-model="updateInvoice.invoiceNo"></el-input>
                </el-form-item>
                <el-form-item label="开票日期:" class="form-item" prop="invoiceDate" :rules="[{ required: true, message: '开票日期不能为空'}]">
                    <el-date-picker type="date" :clearable="false" :editable="false" size="large" id="editKPDate"
                                    @blur="removeDateStyle(3)"
                                    @focus="addDateStyle(3)"
                                    placeholder="选择开票日期" v-model="updateInvoice.invoiceDate"></el-date-picker>
                </el-form-item>
                <el-form-item label="发票金额:" class="form-item">
                    <el-input v-model="updateInvoice.invoiceAmount" @blur="checkInvoiceAmount"></el-input>
                </el-form-item>
                <el-form-item label="校验码:" class="form-item" prop="checkCode" :rules="[{ required: true, message: '校验码不能为空'}]">
                    <el-input v-model="updateInvoice.checkCode" maxlength="6" onkeyup="verificationInputValue(this);" onchange="verificationInputValue(this);"></el-input>
                </el-form-item>
            </el-form>
        </div>
        <span slot="footer" class="dialog-footer">
            <el-button class="btnexport" @click="updateWinShow = false">取消</el-button>
            <el-button type="primary" class="btnexport" @click="checkUpdateMsg">保存</el-button>
        </span>
    </el-dialog>

    <el-dialog title="图片" :visible="imageShow" :before-close="beforeCloseImgWin" width="60%" :close-on-click-modal="false">
        <div class="image_content_area">
            <img id="get_image_area" style="width: 100%" src="">
        </div>

        <span slot="footer" class="dialog-footer">
            <el-button @click="imageShow = false" class="btnexport">关闭</el-button>
        </span>
    </el-dialog>

</div>


</body>
</html>
<script src="../../js/modules/einvoice/einvoicequery.js"></script>