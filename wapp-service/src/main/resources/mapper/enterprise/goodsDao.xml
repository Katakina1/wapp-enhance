<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xforceplus.wapp.modules.enterprise.dao.GoodsDao">
    <select id="queryGoodsList" resultType="com.xforceplus.wapp.modules.enterprise.entity.GoodsEntity">
        /**mycat:schema=${schemaLabel}*/
        SELECT
        id,
        goods_code goodsCode,
        goods_name goodsName,
        ssbm_code ssbmCode,
        ssbm_name ssbmName,
        goods_remark goodsRemark
        FROM t_dx_goods
        WHERE 1=1
        <if test="goodsName != null and goodsName !=''" >
            AND goods_name LIKE  "%"#{goodsName}"%"
        </if>
        <if test="goodsCode != null and goodsCode !=''" >
            AND goods_code LIKE  "%"#{goodsCode}"%"
        </if>
        <if test="ssbmCode != null and ssbmCode !=''" >
            AND ssbm_code LIKE  "%"#{ssbmCode}"%"
        </if>
        <if test="ssbmName != null and ssbmName !=''" >
            AND ssbm_name LIKE  "%"#{ssbmName}"%"
        </if>
        <if test="isBlack != null and isBlack !=''" >
            AND is_black = #{isBlack}
        </if>
        <if test="company != null and company !=''">
            AND company = #{company}
        </if>
        ORDER BY id DESC
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="queryGoodsTotal" resultType="Integer">
        /**mycat:schema=${schemaLabel}*/
        SELECT COUNT(1)
        FROM t_dx_goods
        WHERE 1=1
        <if test="goodsName != null and goodsName !=''" >
            AND goods_name LIKE  "%"#{goodsName}"%"
        </if>
        <if test="goodsCode != null and goodsCode !=''" >
            AND goods_code LIKE  "%"#{goodsCode}"%"
        </if>
        <if test="ssbmCode != null and ssbmCode !=''" >
            AND ssbm_code LIKE  "%"#{ssbmCode}"%"
        </if>
        <if test="ssbmName != null and ssbmName !=''" >
            AND ssbm_name LIKE  "%"#{ssbmName}"%"
        </if>
        <if test="isBlack != null and isBlack !=''" >
            AND is_black = #{isBlack}
        </if>
        <if test="company != null and company !=''">
            AND company = #{company}
        </if>
    </select>

    <select id="queryTaxCodeList" resultType="com.xforceplus.wapp.modules.enterprise.entity.TaxCodeEntity">
        /**mycat:schema=${schemaLabel}*/
        SELECT
        id,`explain`,
        ssbm_code ssbmCode,
        ssbm_name ssbmName,
        ssbm_abbreviation ssbmAbbreviation
        FROM t_dx_goods_num
        WHERE 1=1
        <if test="ssbmCode != null and ssbmCode !=''" >
            AND ssbm_code LIKE  "%"#{ssbmCode}"%"
        </if>
        <if test="ssbmName != null and ssbmName !=''" >
            AND ssbm_name LIKE  "%"#{ssbmName}"%"
        </if>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="queryTaxCodeTotal" resultType="Integer">
        /**mycat:schema=${schemaLabel}*/
        SELECT COUNT(1)
        FROM t_dx_goods_num
        WHERE 1=1
        <if test="ssbmCode != null and ssbmCode !=''" >
            AND ssbm_code LIKE  "%"#{ssbmCode}"%"
        </if>
        <if test="ssbmName != null and ssbmName !=''" >
            AND ssbm_name LIKE  "%"#{ssbmName}"%"
        </if>
    </select>

    <select id="queryGoodsByGoodsCode" resultType="Integer">
         /**mycat:schema=${schemaLabel}*/
        SELECT COUNT(1)
        FROM t_dx_goods
        WHERE is_black = '0'
        AND goods_code = #{goodsEntity.goodsCode}
    </select>

    <select id="queryGoodsByGoodsName" resultType="Integer">
         /**mycat:schema=${schemaLabel}*/
        SELECT COUNT(1)
        FROM t_dx_goods
        WHERE is_black = '0'
        and goods_name = #{goodsEntity.goodsName}
    </select>

    <select id="queryBlackGoodsByGoodsCode" resultType="Integer">
         /**mycat:schema=${schemaLabel}*/
        SELECT COUNT(1)
        FROM t_dx_goods
        WHERE  is_black = '1'
        AND goods_code = #{goodsEntity.goodsCode}
    </select>

    <select id="queryBlackGoodsByGoodsName" resultType="Integer">
         /**mycat:schema=${schemaLabel}*/
        SELECT COUNT(1)
        FROM t_dx_goods
        WHERE is_black = '1'
        AND goods_name = #{goodsEntity.goodsName}
    </select>

    <select id="queryGoodsByCode" resultType="Integer">
        /**mycat:schema=${schemaLabel}*/
        SELECT COUNT(1)
        FROM t_dx_goods
        WHERE goods_code = #{goodsEntity.goodsCode}
    </select>


    <select id="queryTaxCodeBySsbmCode" resultType="com.xforceplus.wapp.modules.enterprise.entity.TaxCodeEntity">
         /**mycat:schema=${schemaLabel}*/
        SELECT
        id,`explain`,
        ssbm_code ssbmCode,
        ssbm_name ssbmName,
        ssbm_abbreviation ssbmAbbreviation
        FROM t_dx_goods_num
        WHERE  ssbm_code = #{goodsEntity.ssbmCode}
    </select>

    <select id="queryGoodsById" resultType="com.xforceplus.wapp.modules.enterprise.entity.GoodsEntity">
         /**mycat:schema=${schemaLabel}*/
        SELECT
        id,
        goods_code goodsCode,
        goods_name goodsName,
        goods_remark goodsRemark,
        ssbm_code ssbmCode,
        ssbm_name ssbmName
        FROM t_dx_goods
        WHERE id = #{goodsId}
    </select>

    <delete id="deleteBatchGoods">
        /**mycat:schema=${schemaLabel}*/
        DELETE FROM t_dx_goods
        WHERE id IN (
        <foreach collection="goodsIds" item="goodsId" index="index" separator=",">
            #{goodsId}
        </foreach>
        )
    </delete>

    <update id="updateGoods">
        /**mycat:schema=${schemaLabel}*/
        UPDATE t_dx_goods
        <set>
            <if test="goodsEntity.goodsCode != null">`goods_code` = #{goodsEntity.goodsCode}, </if>
            <if test="goodsEntity.goodsName != null">`goods_name` = #{goodsEntity.goodsName}, </if>
            <if test="goodsEntity.goodsRemark != null">`goods_remark` = #{goodsEntity.goodsRemark},</if>
            <if test="goodsEntity.ssbmCode != null">`ssbm_code` = #{goodsEntity.ssbmCode},</if>
            <if test="goodsEntity.ssbmName != null">`ssbm_name` = #{goodsEntity.ssbmName},</if>
        </set>
        WHERE id = #{goodsEntity.id}
    </update>

    <update id="updateGoodsAsBlack">
        /**mycat:schema=${schemaLabel}*/
        UPDATE t_dx_goods
        <set>
            `is_black` = '1',
        </set>
        WHERE goods_code = #{goodsEntity.goodsCode}
    </update>

    <insert id="saveBlackGoods">
         /**mycat:schema=${schemaLabel}*/
        INSERT INTO t_dx_goods
        (
        `goods_code`,
        `goods_name`,
        `goods_remark`,
        `company`,
        `is_black`,
        `ssbm_id`,
        `ssbm_code`,
        `ssbm_name`
        )
        VALUES
        (
        #{goodsEntity.goodsCode},
        #{goodsEntity.goodsName},
        #{goodsEntity.goodsRemark},
        #{goodsEntity.company},
        '1',
        -1,
        '',
        ''
        )
    </insert>

    <insert id="saveGoods">
         /**mycat:schema=${schemaLabel}*/
        INSERT INTO t_dx_goods
        (
        `goods_code`,
        `goods_name`,
        `goods_remark`,
        `company`,
        `is_black`,
        `ssbm_id`,
        `ssbm_code`,
        `ssbm_name`
        )
        VALUES
        (
        #{goodsEntity.goodsCode},
        #{goodsEntity.goodsName},
        #{goodsEntity.goodsRemark},
        #{goodsEntity.company},
        '0',
        #{goodsEntity.ssbmId},
        #{goodsEntity.ssbmCode},
        #{goodsEntity.ssbmName}
        )
    </insert>
</mapper>