<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xforceplus.wapp.modules.base.dao.UniversalTaxRateDao">
    <select id="queryList" resultType="com.xforceplus.wapp.modules.base.entity.UniversalTaxRateEntity">
       select * from(
        select vendor_nbr,
        dept_id,
        vendor_name,
        ROW_NUMBER() OVER(Order by dept_id desc) AS rownum
        from t_dx_tax_commodity
        where 1=1
        <if test="map.vendorNbr != null and map.vendorNbr != ''">
            and vendor_nbr  like concat('%',concat(#{map.vendorNbr},'%'))
        </if>
        <if test="map.vendorName != null and map.vendorName != ''">
            and vendor_name like concat('%',concat(#{map.vendorName},'%'))
        </if>
        group by
        vendor_nbr,
        dept_id,
        vendor_name
       )a
        <if test="map.offset != null and map.limit != null">
            where <![CDATA[rownum>#{map.offset} and rownum<=#{map.offset}+#{map.limit}]]>
        </if>
    </select>

    <select id="queryCount" resultType="int">
        select count(1)
        from (select vendor_nbr,
        dept_id,
        vendor_name
        from t_dx_tax_commodity where 1=1
        <if test="map.vendorNbr != null and map.vendorNbr != ''">
            and vendor_nbr  like concat('%',concat(#{map.vendorNbr},'%'))
        </if>
        <if test="map.vendorName != null and map.vendorName != ''">
            and vendor_name like concat('%',concat(#{map.vendorName},'%'))
        </if>
        group by
        vendor_nbr,
        dept_id,
        vendor_name) temp
    </select>

    <select id="queryCommodity" resultType="com.xforceplus.wapp.modules.base.entity.UniversalTaxRateEntity">
        select * from(
        select id , item_nbr,
        notes,
        input_tax+'%' input_tax,
        ROW_NUMBER() OVER(Order by id desc) AS rownum
        from t_dx_tax_commodity
        where 1=1
        <if test="map.vendorNbr != null and map.vendorNbr != ''">
            and vendor_nbr = #{map.vendorNbr}
        </if>
        <if test="map.vendorName != null and map.vendorName != ''">
            and vendor_name = #{map.vendorName}
        </if>
        <if test="map.deptId != null and map.deptId != ''">
            and dept_id = #{map.deptId}
        </if>
        <if test="map.itemNbr != null and map.itemNbr != ''">
            and item_nbr  like concat('%',concat(#{map.itemNbr},'%'))
        </if>
        <if test="map.notes != null and map.notes != ''">
            and notes  like concat('%',concat(#{map.notes},'%'))
        </if>
        )a
        <if test="map.offset != null and map.limit != null">
            where <![CDATA[rownum>#{map.offset} and rownum<=#{map.offset}+#{map.limit}]]>
        </if>
</select>

    <select id="queryCommodityCount" resultType="int">
        select count(1)
        from (select id,item_nbr,
        notes,
        input_tax,
        ROW_NUMBER() OVER(Order by id desc) AS rownum
        from t_dx_tax_commodity
        where 1=1
        <if test="map.vendorNbr != null and map.vendorNbr != ''">
            and vendor_nbr = #{map.vendorNbr}
        </if>
        <if test="map.vendorName != null and map.vendorName != ''">
            and vendor_name = #{map.vendorName}
        </if>
        <if test="map.deptId != null and map.deptId != ''">
            and dept_id = #{map.deptId}
        </if>
        <if test="map.itemNbr != null and map.itemNbr != ''">
            and item_nbr  like concat('%',concat(#{map.itemNbr},'%'))
        </if>
        <if test="map.notes != null and map.notes != ''">
            and notes  like concat('%',concat(#{map.notes},'%'))
        </if>
        ) t
        <if test="map.offset != null and map.limit != null">
            where <![CDATA[rownum>#{map.offset} and rownum<=#{map.offset}+#{map.limit}]]>
        </if>
    </select>

    <insert id="insertUniversalTaxRate" >
        insert  into t_dx_tax_commodity(
        vendor_nbr,
        vendor_name,
        dept_id,
        item_nbr,
        notes,
        input_tax
        )
        values(
        #{universalTax.vendorNbr},
        #{universalTax.vendorName},
        #{universalTax.deptId},
        #{universalTax.itemNbr},
        #{universalTax.notes},
        #{universalTax.inputTax}
        )
    </insert>
    <update id="updateUniversalTaxRate" >
        update t_dx_tax_commodity set
        vendor_name = #{vendorName},
        item_nbr = #{itemNbr},
        notes = #{notes},
        input_tax = #{inputTax}
      where vendor_nbr =#{vendorNbr} and dept_id = #{deptId} and item_nbr =#{itemNbr} and  input_tax =#{inputTax}

    </update>

    <insert id="saveCommodity" >
        insert  into t_dx_tax_commodity(
        vendor_nbr,
        vendor_name,
        dept_id,
        item_nbr,
        notes,
        input_tax
        )
        values(
        #{entity.vendorNbr},
        #{entity.vendorName},
        #{entity.deptId},
        #{entity.itemNbr},
        #{entity.notes},
        #{entity.inputTax}
        )
    </insert>

    <delete id="deleteCommodity" parameterType="int">
        delete from t_dx_tax_commodity where id in
        <foreach item="id" collection="ids" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
        <select id="selectCont" resultType="int">
            select count(1) from t_dx_tax_commodity where  vendor_nbr= #{vendorNbr} and  dept_id =#{deptId} and item_nbr =#{itemNbr} and  input_tax =#{inputTax}
        </select>

    <select id="getCount" resultType="int">
            select count(1) from t_dx_tax_commodity where  item_nbr= #{itemNbr}
     </select>

    <delete id="deleteVendor">
        delete from t_dx_tax_commodity where vendor_nbr= #{vendorNbr}
    </delete>


</mapper>