<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xforceplus.wapp.modules.businessData.dao.ClaimDao">



    <resultMap id="cMap" type="com.xforceplus.wapp.modules.posuopei.entity.ClaimEntity">
        <id column="id" property="id"/>
        <result column="return_goods_code" property="claimno"/>
        <result column="supplier_association" property="venderid"/>
        <result column="return_cost_amount" property="claimAmount"/>
        <result column="exchangeno" property="exchangeno"/>
        <result column="return_goods_date" property="postdate"/>
        <result column="host_status" property="hoststatus"/>
        <!--<result column="errcode" property="errcode"/>-->
        <!--<result column="errdesc" property="errdesc"/>-->
        <result column="dept" property="dept"/>
        <result column="match_status" property="matchstatus"/>
        <result column="matchno" property="matchno"/>
        <result column="invoiceNo" property="invoiceno"/>
        <!--<result column="certificate_no" property="certificateno"/>-->
    </resultMap>



   <select id="claimQueryList" resultMap="cMap">
       SELECT
       <if test="offset != null and limit != null">
           TOP (#{limit})
       </if>
       A.*
       FROM
       (
       SELECT
       row_number() OVER (ORDER BY o.id DESC ) AS rownumber, o.*
       FROM(
       SELECT * FROM t_dx_return_goods with(nolock)
       WHERE
       supplier_association=#{venderid}
       <if test="jvcode !=null and jvcode !=''">
           AND  jvcode=#{jvcode} 
       </if>
       <if test="invoiceNo != null and invoiceNo != ''">
           and invoiceNo like concat('%',concat(#{invoiceNo},'%'))
       </if>
       <if test="claimno !=null and claimno !=''">
           AND return_goods_code like concat('%',concat(#{claimno},'%'))
       </if>
       <if test="matchstatus !='-1'">
           AND match_status=#{matchstatus}
       </if>
       <if test="poDateStart !=null and poDateStart !=''">
           <![CDATA[ AND SUBSTRING(convert(varchar(100),return_goods_date,20),0,11)  >= #{poDateStart} ]]>
       </if>
       <if test="poDateEnd !=null and poDateEnd !=''">
           <![CDATA[ AND SUBSTRING(convert(varchar(100),return_goods_date,20),0,11)  <= #{poDateEnd} ]]>
       </if>
       <![CDATA[ and datediff(day,return_goods_date,GETDATE()) < 728]]>
       and substring(invoiceNo,0,8) ='0000000'
       )as o)as A
       WHERE 1=1
       <if test="offset != null and limit != null">

           and rownumber > #{offset}
       </if>
   </select>
    <select id="claimQueryCount" resultType="Integer">
        SELECT count(1) FROM t_dx_return_goods with(nolock)
        WHERE
        supplier_association=#{venderid}
        <if test="claimno !=null and claimno !=''">
            AND return_goods_code like concat('%',concat(#{claimno},'%'))
        </if>
        <if test="invoiceNo != null and invoiceNo != ''">
            and invoiceNo like concat('%',concat(#{invoiceNo},'%'))
        </if>
        <if test="matchstatus !='-1'">
            AND match_status=#{matchstatus}
        </if>
        <if test="poDateStart !=null and poDateStart !=''">
            <![CDATA[ AND SUBSTRING(convert(varchar(100),return_goods_date,20),0,11)  >= #{poDateStart} ]]>
        </if>
        <if test="poDateEnd !=null and poDateEnd !=''">
            <![CDATA[ AND SUBSTRING(convert(varchar(100),return_goods_date,20),0,11)  <= #{poDateEnd} ]]>
        </if>
        <![CDATA[ and datediff(day,return_goods_date,GETDATE()) < 728]]>
        and substring(invoiceNo,0,8) ='0000000'
    </select>


</mapper>