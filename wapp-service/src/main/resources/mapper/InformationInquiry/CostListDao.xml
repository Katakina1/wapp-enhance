<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xforceplus.wapp.modules.InformationInquiry.dao.CostListDao">
    <!--查询扫描信息-->
    <select id="scanningList" resultType="com.xforceplus.wapp.modules.InformationInquiry.entity.ScanningEntity">
        <if test="map.offset != null and map.limit != null">
            SELECT
            TOP (#{map.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY id desc) AS rownumber, o.*
            FROM
            (
        </if>
        select
        v.id,
        v.jv_code            jvCode,
        v.company_code       companyCode,
        v.venderid,
        v.gf_name            gfName,
        v.xf_name            xfName,
        v.invoice_no         invoiceNo,
        v.invoice_type       invoiceType,
        v.invoice_date       invoiceDate,
        v.invoice_amount     invoiceAmount,
        v.refund_notes       refundNotes,
        v.rebateno,
        v.rebate_expressno   rebateExpressno
        from t_dx_invoice v WITH(NOLOCK)
        left join t_dx_record_invoice r WITH(NOLOCK) ON v.uuid=r.uuid
        <where>
            and r.flow_type='2'
            <if test="map.venderid != null and map.venderid != ''">
                and v.venderid like concat('%',concat(#{map.venderid},'%'))
            </if>
            <if test="map.invoiceNo != null and map.invoiceNo != ''">
                and v.invoice_no like concat('%',concat(#{map.invoiceNo},'%'))
            </if>
            <if test="map.invoiceDate1 != null and map.invoiceDate1 != ''">
                <![CDATA[ AND convert(varchar(10),v.invoice_date,23) >= #{map.invoiceDate1} ]]>
            </if>
            <if test="map.invoiceDate2 != null and map.invoiceDate2 != ''">
                <![CDATA[ AND convert(varchar(10),v.invoice_date,23)  <= #{map.invoiceDate2} ]]>
            </if>
        </where>
        <if test="map.offset != null and map.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber >#{map.offset}
        </if>
    </select>

    <!--查询扫描信息条数-->
    <select id="scanningCount" resultType="Integer">
        select count(1)
        from t_dx_invoice v WITH(NOLOCK)
        left join t_dx_record_invoice r WITH(NOLOCK) ON v.uuid=r.uuid
        <where>
            and r.flow_type='2'
            <if test="map.venderid != null and map.venderid != ''">
                and v.venderid like concat('%',concat(#{map.venderid},'%'))
            </if>
            <if test="map.invoiceNo != null and map.invoiceNo != ''">
                and v.invoice_no like concat('%',concat(#{map.invoiceNo},'%'))
            </if>
            <if test="map.invoiceDate1 != null and map.invoiceDate1 != ''">
                <![CDATA[ AND convert(varchar(10),v.invoice_date,23) >= #{map.invoiceDate1} ]]>
            </if>
            <if test="map.invoiceDate2 != null and map.invoiceDate2 != ''">
                <![CDATA[ AND convert(varchar(10),v.invoice_date,23)  <= #{map.invoiceDate2} ]]>
            </if>
        </where>
    </select>


</mapper>