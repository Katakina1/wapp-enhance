<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xforceplus.wapp.modules.InformationInquiry.dao.PoInquiryDao">
    <!--查询订单信息-->
    <select id="polist" resultType="com.xforceplus.wapp.modules.InformationInquiry.entity.poEntity">
        SELECT
        <if test="map.offset != null and map.limit != null">
            TOP (#{map.limit})
        </if>
        A.*
        FROM
        (
        SELECT
        row_number () OVER (ORDER BY id desc) AS rownumber, o.*
        FROM
        (
        select
        id            Id,
        pocode        poCode,
        receiptid     receiptId,
        receiptdate   receiptDate,
        receiptAmount,
        host_status   hostStatus,
        dxhy_match_status  dxhyMatchStatus,
        venderid      venderId,
        vendername,
        jvcode,
        amountpaid,
        amountunpaid,
        due_date      dueDate,
        invoice_no    invoiceNo,
        po_type       poType,
        tractionNbr,
        newAmount
        from t_dx_po_detail WITH(NOLOCK)
        <where>
            <if test="map.venderId != null and map.venderId != ''">
                and venderid like concat('%',concat(#{map.venderId},'%'))
            </if>
            <if test="map.venderName != null and map.venderName != ''">
                and vendername like concat('%',concat(#{map.venderName},'%'))
            </if>
            <if test="map.poCode != null and map.poCode != ''">
                and pocode like concat('%',concat(#{map.poCode},'%'))
            </if>

            <if test="map.invoiceNo != null and map.invoiceNo != ''">
                and invoice_no like concat('%',concat(#{map.invoiceNo},'%'))
            </if>
            <if test="map.receiptId != null and map.receiptId != ''">
                and receiptid like concat('%',concat(#{map.receiptId},'%'))
            </if>
            <if test="map.invoiceDate1 != null and map.invoiceDate1 != ''">
                <![CDATA[ AND convert(varchar(10),receiptdate,23) >= #{map.invoiceDate1} ]]>
            </if>
            <if test="map.invoiceDate2 != null and map.invoiceDate2 != ''">
                <![CDATA[ AND convert(varchar(10),receiptdate,23)  <= #{map.invoiceDate2} ]]>
            </if>
            <if test="map.dxhyMatchStatus != '-1'">
                AND dxhy_match_status=#{map.dxhyMatchStatus}
            </if>
            <choose>
                <when test="map.hoststatus ==0">
                    AND (host_status in ('0','1','10') or host_status is null)
                </when>
                <when test="map.hoststatus ==1">
                    AND host_status in ('5','11','12')
                </when>
                <when test="map.hoststatus ==2">
                    AND host_status in ('9','14')
                </when>
                <when test="map.hoststatus ==3">
                    AND host_status in ('15','19','99','999')
                </when>
                <when test="map.hoststatus ==8">
                    AND host_status in ('8')
                </when>
                <otherwise></otherwise>
            </choose>
        </where>
        )
        AS o
        )A
        WHERE 1=1
        <if test="map.offset != null and map.limit != null">
            and rownumber >#{map.offset}
        </if>
    </select>

    <!--查询订单信息条数-->
    <select id="polistCount" resultType="Integer">
        select count(1)
        from t_dx_po_detail WITH(NOLOCK)
        <where>
            <if test="map.venderId != null and map.venderId != ''">
                and venderid like concat('%',concat(#{map.venderId},'%'))
            </if>
            <if test="map.venderName != null and map.venderName != ''">
                and vendername like concat('%',concat(#{map.venderName},'%'))
            </if>
            <if test="map.poCode != null and map.poCode != ''">
                and pocode like concat('%',concat(#{map.poCode},'%'))
            </if>
            <if test="map.invoiceNo != null and map.invoiceNo != ''">
                and invoice_no like concat('%',concat(#{map.invoiceNo},'%'))
            </if>
            <if test="map.receiptId != null and map.receiptId != ''">
                and receiptid like concat('%',concat(#{map.receiptId},'%'))
            </if>
            <if test="map.invoiceDate1 != null and map.invoiceDate1 != ''">
                <![CDATA[ AND convert(varchar(10),receiptdate,23) >= #{map.invoiceDate1} ]]>
            </if>
            <if test="map.invoiceDate2 != null and map.invoiceDate2 != ''">
                <![CDATA[ AND convert(varchar(10),receiptdate,23)  <= #{map.invoiceDate2} ]]>
            </if>
            <if test="map.dxhyMatchStatus != '-1'">
                AND dxhy_match_status=#{map.dxhyMatchStatus}
            </if>
            <choose>
                <when test="map.hoststatus ==0">
                    AND (host_status in ('0','1','10') or host_status is null)
                </when>
                <when test="map.hoststatus ==1">
                    AND host_status in ('5','11','12')
                </when>
                <when test="map.hoststatus ==2">
                    AND host_status in ('9','14')
                </when>
                <when test="map.hoststatus ==3">
                    AND host_status in ('15','19','99','999')
                </when>
                <when test="map.hoststatus ==8">
                    AND host_status in ('8')
                </when>
                <otherwise></otherwise>
            </choose>
        </where>
    </select>

    <!--查询订单信息-->
    <select id="poExcellist" resultType="com.xforceplus.wapp.modules.InformationInquiry.entity.poExcelEntity">
        SELECT
        <if test="map.offset != null and map.limit != null">
            TOP (#{map.limit})
        </if>
        A.*
        FROM
        (
        SELECT
        row_number () OVER (ORDER BY id desc) AS rownumber, o.*
        FROM
        (
        select
        id            Id,
        pocode        poCode,
        receiptid     receiptId,
        receiptdate   receiptDate,
        receiptAmount,
        host_status   hostStatus,
        dxhy_match_status  dxhyMatchStatus,
        venderid      venderId,
        vendername,
        jvcode,
        amountpaid,
        amountunpaid,
        due_date      dueDate,
        invoice_no    invoiceNo,
        po_type       poType,
        tractionNbr
        from t_dx_po_detail WITH(NOLOCK)
        <where>
            <if test="map.venderId != null and map.venderId != ''">
                and venderid like concat('%',concat(#{map.venderId},'%'))
            </if>
            <if test="map.venderName != null and map.venderName != ''">
                and vendername like concat('%',concat(#{map.venderName},'%'))
            </if>
            <if test="map.poCode != null and map.poCode != ''">
                and pocode like concat('%',concat(#{map.poCode},'%'))
            </if>

            <if test="map.invoiceNo != null and map.invoiceNo != ''">
                and invoice_no like concat('%',concat(#{map.invoiceNo},'%'))
            </if>
            <if test="map.receiptId != null and map.receiptId != ''">
                and receiptid like concat('%',concat(#{map.receiptId},'%'))
            </if>
            <if test="map.invoiceDate1 != null and map.invoiceDate1 != ''">
                <![CDATA[ AND convert(varchar(10),receiptdate,23) >= #{map.invoiceDate1} ]]>
            </if>
            <if test="map.invoiceDate2 != null and map.invoiceDate2 != ''">
                <![CDATA[ AND convert(varchar(10),receiptdate,23)  <= #{map.invoiceDate2} ]]>
            </if>
            <if test="map.dxhyMatchStatus != '-1'">
                AND dxhy_match_status=#{map.dxhyMatchStatus}
            </if>
            <choose>
                <when test="map.hoststatus ==0">
                    AND (host_status in ('0','1','10') or host_status is null)
                </when>
                <when test="map.hoststatus ==1">
                    AND host_status in ('5','11','12')
                </when>
                <when test="map.hoststatus ==2">
                    AND host_status in ('9','14')
                </when>
                <when test="map.hoststatus ==3">
                    AND host_status in ('15','19','99','999')
                </when>
                <when test="map.hoststatus ==8">
                    AND host_status in ('8')
                </when>
                <otherwise></otherwise>
            </choose>
        </where>
        )
        AS o
        )A
        WHERE 1=1
        <if test="map.offset != null and map.limit != null">
            and rownumber >#{map.offset}
        </if>
    </select>
</mapper>