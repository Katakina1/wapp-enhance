<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xforceplus.wapp.modules.InformationInquiry.dao.PaymentDetailEntityDao">

    <resultMap id="BaseResultMap" type="com.xforceplus.wapp.modules.InformationInquiry.entity.PaymentDetailEntity">
        <result column="subject" jdbcType="NVARCHAR" property="subject"/>
        <result column="company_code" jdbcType="NVARCHAR" property="companyCode"/>
        <result column="document_type" jdbcType="NVARCHAR" property="documentType"/>
        <result column="certificate_no" jdbcType="NVARCHAR" property="certificateNo"/>
        <result column="write_off" jdbcType="NVARCHAR" property="writeOff"/>
        <result column="clearance_voucher" jdbcType="NVARCHAR" property="clearanceVoucher"/>
        <result column="clearing_date" jdbcType="TIMESTAMP" property="clearingDate"/>
        <result column="refer_to" jdbcType="NVARCHAR" property="referTo"/>
        <result column="show_currency_amount" jdbcType="DECIMAL" property="showCurrencyAmount"/>
        <result column="voucher_currency" jdbcType="NVARCHAR" property="voucherCurrency"/>
        <result column="currency" jdbcType="NVARCHAR" property="currency"/>
        <result column="currency_amount" jdbcType="DECIMAL" property="currencyAmount"/>
        <result column="posting_date" jdbcType="TIMESTAMP" property="postingDate"/>
        <result column="payment_date" jdbcType="TIMESTAMP" property="paymentDate"/>
        <result column="tax_code" jdbcType="NVARCHAR" property="taxCode"/>
        <result column="fiscal_year" jdbcType="NVARCHAR" property="fiscalYear"/>
        <result column="cost_center" jdbcType="NVARCHAR" property="costCenter"/>
        <result column="profit_center" jdbcType="NVARCHAR" property="profitCenter"/>
        <result column="jvcode" jdbcType="NVARCHAR" property="jvcode"/>
        <result column="venderid" jdbcType="NVARCHAR" property="venderid"/>
        <result column="creation_date" jdbcType="TIMESTAMP" property="creationDate"/>
        <result column="amend_date" jdbcType="TIMESTAMP" property="amendDate"/>
        <result column="invoice_date" jdbcType="TIMESTAMP" property="invoiceDate"/>
        <result column="document_header_text" jdbcType="LONGNVARCHAR" property="documentHeaderText"/>
        <result column="invoice_text" jdbcType="LONGNVARCHAR" property="invoiceText"/>
        <result column="orgName" jdbcType="NVARCHAR" property="orgName"/>
        <result column="usercode" property="usercode"/>
        <association property="userEntity" javaType="com.xforceplus.wapp.modules.base.entity.UserEntity">
            <result column="auUserCode" property="usercode"/>
            <result property="orgid" column="orgid"/>
        </association>
    </resultMap>

    <!--查询订单信息-->
    <select id="findPayList" resultMap="BaseResultMap">
        <if test="map.offset != null and map.limit != null">
            SELECT
            TOP (#{map.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY o.payment_date desc) AS rownumber, o.*
            FROM
            (
        </if>
        select
        d.*,
        au.usercode auUserCode,
        au.orgid,
        (select org.orgname from t_ac_org org WITH(NOLOCK) where org.orgid = au.orgid) as orgName
        from t_dx_dsign d
        left join t_ac_user au WITH(NOLOCK) on d.venderid = au.usercode
        <where>
            <if test="map.venderid != null and map.venderid != ''">
                and d.venderid like concat('%',concat(#{map.venderid},'%'))
            </if>
            <if test="map.documentType != null and map.documentType != ''">
                and d.document_type  = #{map.documentType}
            </if>
            <if test="map.referTo != null and map.referTo != ''">
                and d.refer_to like concat('%',concat(#{map.referTo},'%'))
            </if>
            <if test="map.jvcode != null and map.jvcode != '-1'">
                and d.jvcode = #{map.jvcode}
            </if>
            <if test="map.paymentDate1 != null and map.paymentDate1 != ''">
                <![CDATA[ AND convert(varchar(100),d.payment_date,23) >= #{map.paymentDate1} ]]>
            </if>
            <if test="map.paymentDate2 != null and map.paymentDate2 != ''">
                <![CDATA[ AND convert(varchar(10),d.payment_date,23)  <= #{map.paymentDate2} ]]>
            </if>
        </where>
        <if test="map.offset != null and map.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber > #{map.offset}
        </if>
    </select>

    <!--查询订单信息条数-->
    <select id="paylistCount" resultType="java.lang.Integer">
        select count(1)
        from t_dx_dsign d
        <where>
            <if test="map.venderid != null and map.venderid != ''">
                and d.venderid like concat('%',concat(#{map.venderid},'%'))
            </if>
            <if test="map.documentType != null and map.documentType != ''">
                and d.document_type  = #{map.documentType}
            </if>
            <if test="map.referTo != null and map.referTo != ''">
                and d.refer_to like concat('%',concat(#{map.referTo},'%'))
            </if>
            <if test="map.jvcode != null and map.jvcode != '-1'">
                and d.jvcode = #{map.jvcode}
            </if>
            <if test="map.paymentDate1 != null and map.paymentDate1 != ''">
                <![CDATA[ AND convert(varchar(100),d.payment_date,23) >= #{map.paymentDate1} ]]>
            </if>
            <if test="map.paymentDate2 != null and map.paymentDate2 != ''">
                <![CDATA[ AND convert(varchar(10),d.payment_date,23)  <= #{map.paymentDate2} ]]>
            </if>
        </where>
    </select>


</mapper>