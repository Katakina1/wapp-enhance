<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xforceplus.wapp.modules.index.dao.IndexStatisticsMapper">
    <!--发票采集-->
    <resultMap id="IndexInvoiceCollectionMap" type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceCollectionModel">
        <result column="id" jdbcType="BIGINT" property="id"/>
        <result column="invoice_type" jdbcType="VARCHAR" property="invoiceType"/>
        <result column="invoice_code" jdbcType="VARCHAR" property="invoiceCode"/>
        <result column="invoice_no" jdbcType="VARCHAR" property="invoiceNo"/>
        <result column="invoice_date" jdbcType="TIMESTAMP" property="invoiceDate"/>
        <result column="gf_tax_no" jdbcType="VARCHAR" property="gfTaxNo"/>
        <result column="gf_name" jdbcType="VARCHAR" property="gfName"/>
        <result column="gf_address_and_phone" jdbcType="VARCHAR" property="gfAddressAndPhone"/>
        <result column="gf_bank_and_no" jdbcType="VARCHAR" property="gfBankAndNo"/>
        <result column="xf_tax_no" jdbcType="VARCHAR" property="xfTaxNo"/>
        <result column="xf_name" jdbcType="VARCHAR" property="xfName"/>
        <result column="xf_address_and_phone" jdbcType="VARCHAR" property="xfAddressAndPhone"/>
        <result column="xf_bank_and_no" jdbcType="VARCHAR" property="xfBankAndNo"/>
        <result column="invoice_amount" jdbcType="DECIMAL" property="invoiceAmount"/>
        <result column="tax_amount" jdbcType="DECIMAL" property="taxAmount"/>
        <result column="total_amount" jdbcType="DECIMAL" property="totalAmount"/>
        <result column="invoice_status" jdbcType="VARCHAR" property="invoiceStatus"/>
        <result column="status_update_date" jdbcType="TIMESTAMP" property="statusUpdateDate"/>
        <result column="last_update_date" jdbcType="TIMESTAMP" property="lastUpdateDate"/>
        <result column="rzh_date" jdbcType="TIMESTAMP" property="rzhDate"/>
        <result column="qs_date" jdbcType="TIMESTAMP" property="qsDate"/>
        <result column="rzh_belong_date_late" jdbcType="VARCHAR" property="rzhBelongDateLate"/>
        <result column="rzh_belong_date" jdbcType="VARCHAR" property="rzhBelongDate"/>
        <result column="confirm_date" jdbcType="TIMESTAMP" property="confirmDate"/>
        <result column="rzh_type" jdbcType="VARCHAR" property="rzhType"/>
        <result column="rzh_yesorno" jdbcType="VARCHAR" property="rzhYesorno"/>
        <result column="gx_user_account" jdbcType="VARCHAR" property="gxUserAccount"/>
        <result column="gx_user_name" jdbcType="VARCHAR" property="gxUserName"/>
        <result column="source_system" jdbcType="VARCHAR" property="sourceSystem"/>
        <result column="valid" jdbcType="VARCHAR" property="valid"/>
        <result column="uuid" jdbcType="VARCHAR" property="uuid"/>
        <result column="create_date" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="gx_date" jdbcType="TIMESTAMP" property="gxDate"/>
        <result column="rzh_back_msg" jdbcType="VARCHAR" property="rzhBackMsg"/>
        <result column="dqskssq" jdbcType="VARCHAR" property="dqskssq"/>
        <result column="gxjzr" jdbcType="VARCHAR" property="gxjzr"/>
        <result column="gxfwq" jdbcType="VARCHAR" property="gxfwq"/>
        <result column="gxfwz" jdbcType="VARCHAR" property="gxfwz"/>
        <result column="sfygx" jdbcType="VARCHAR" property="sfygx"/>
        <result column="detail_yesorno" jdbcType="VARCHAR" property="detailYesorno"/>
        <result column="gx_type" jdbcType="VARCHAR" property="gxType"/>
        <result column="auth_status" jdbcType="VARCHAR" property="authStatus"/>
        <result column="send_date" jdbcType="TIMESTAMP" property="sendDate"/>
        <result column="rzlx" jdbcType="VARCHAR" property="rzlx"/>
        <result column="sfdbts" jdbcType="VARCHAR" property="sfdbts"/>
        <result column="qs_type" jdbcType="VARCHAR" property="qsType"/>
        <result column="qs_status" jdbcType="VARCHAR" property="qsStatus"/>
        <result column="check_code" jdbcType="VARCHAR" property="checkCode"/>
        <result column="txfbz" jdbcType="VARCHAR" property="txfbz"/>
        <result column="lslbz" jdbcType="VARCHAR" property="lslbz"/>
        <result column="out_status" jdbcType="VARCHAR" property="outStatus"/>
        <result column="out_invoice_amout" jdbcType="DECIMAL" property="outInvoiceAmout"/>
        <result column="out_tax_amount" jdbcType="DECIMAL" property="outTaxAmount"/>
        <result column="out_reason" jdbcType="VARCHAR" property="outReason"/>
        <result column="out_date" jdbcType="TIMESTAMP" property="outDate"/>
        <result column="remark" jdbcType="LONGVARCHAR" property="remark"/>
        <result column="out_remark" jdbcType="LONGVARCHAR" property="outRemark"/>
        <result column="authenticationType" property="authenticationType"/>
        <result column="scan_match_status" property="scanMatchStatus"/>
    </resultMap>
    <!--发票扫描-->
    <resultMap id="IndexInvoiceScanningMap" type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceScanningModel">
        <result column="id" jdbcType="BIGINT" property="id"/>
        <result column="invoice_type" jdbcType="VARCHAR" property="invoiceType"/>
        <result column="invoice_code" jdbcType="VARCHAR" property="invoiceCode"/>
        <result column="invoice_no" jdbcType="VARCHAR" property="invoiceNo"/>
        <result column="invoice_serial_no" jdbcType="VARCHAR" property="invoiceSerialNo"/>
        <result column="gf_tax_no" jdbcType="VARCHAR" property="gfTaxNo"/>
        <result column="gf_name" jdbcType="VARCHAR" property="gfName"/>
        <result column="xf_tax_no" jdbcType="VARCHAR" property="xfTaxNo"/>
        <result column="xf_name" jdbcType="VARCHAR" property="xfName"/>
        <result column="invoice_amount" jdbcType="DECIMAL" property="invoiceAmount"/>
        <result column="tax_amount" jdbcType="DECIMAL" property="taxAmount"/>
        <result column="total_amount" jdbcType="DECIMAL" property="totalAmount"/>
        <result column="invoice_date" jdbcType="TIMESTAMP" property="invoiceDate"/>
        <result column="user_account" jdbcType="VARCHAR" property="userAccount"/>
        <result column="user_name" jdbcType="VARCHAR" property="userName"/>
        <result column="qs_type" jdbcType="VARCHAR" property="qsType"/>
        <result column="qs_status" jdbcType="VARCHAR" property="qsStatus"/>
        <result column="valid" jdbcType="VARCHAR" property="valid"/>
        <result column="uuid" jdbcType="VARCHAR" property="uuid"/>
        <result column="create_date" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="update_date" jdbcType="TIMESTAMP" property="updateDate"/>
        <result column="qs_date" jdbcType="TIMESTAMP" property="qsDate"/>
        <result column="scan_id" jdbcType="VARCHAR" property="scanId"/>
        <result column="notes" jdbcType="VARCHAR" property="notes"/>
        <result column="check_code" jdbcType="VARCHAR" property="checkCode"/>
    </resultMap>
    <!--今日发票采集map-->
    <resultMap id="indexInvoiceCollectionCountMap"
               type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceCollectionCountModel">
        <result column="countNum" property="countNum"/>
        <result column="invoiceType" property="invoiceType"/>
    </resultMap>

    <resultMap id="indexInvoiceScanMatchCountMap"
               type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceScanMatchCountModel">
        <result column="countNum" property="countNum"/>
        <result column="scanMatchStatus" property="scanMatchStatus"/>
    </resultMap>
    <!--发票扫描-->
    <resultMap id="IndexInvoiceScanMatchMap" type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceScanMatchModel">
        <result column="id" jdbcType="BIGINT" property="id"/>
        <result column="redticket_data_serial_number" jdbcType="VARCHAR" property="redticketDataSerialNumber"/>
        <result column="red_total_amount" jdbcType="DECIMAL" property="redTotalAmount"/>
        <result column="redticket_creation_time" jdbcType="TIMESTAMP" property="redticketCreationTime"/>
        <result column="invoice_type" jdbcType="VARCHAR" property="invoiceType"/>
        <result column="invoice_code" jdbcType="VARCHAR" property="invoiceCode"/>
        <result column="invoice_no" jdbcType="VARCHAR" property="invoiceNo"/>
        <result column="tax_rate" jdbcType="DECIMAL" property="taxRate"/>
        <result column="venderid" jdbcType="VARCHAR" property="venderId"/>
        <result column="gf_tax_no" jdbcType="VARCHAR" property="gfTaxNo"/>
        <result column="invoice_amount" jdbcType="DECIMAL" property="invoiceAmount"/>
        <result column="tax_amount" jdbcType="DECIMAL" property="taxAmount"/>
        <result column="total_amount" jdbcType="DECIMAL" property="totalAmount"/>
    </resultMap>
    <!--今日发票扫描map-->
    <resultMap id="indexInvoiceScanningCountMap" type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceScanningCountModel">
        <result column="qsType" property="qsType"/>
        <result column="countNum" property="countNum"/>
    </resultMap>


    <!--今日发票认证map-->
    <resultMap id="indexInvoiceAuthenticationCountMap"
               type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceAuthenticationCountModel">
        <result column="authenticationType" property="authenticationType"/>
        <result column="countNum" property="countNum"/>
    </resultMap>

    <!--本月新增发票信息-->
    <resultMap id="indexInvoiceInformationOfMonthMap"
               type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceMonthInformationModel">
        <result column="xzInvoice" property="xzInvoice"/>
        <result column="yrzInvoice" property="yrzInvoice"/>
        <result column="taxAmountCount" property="taxAmountCount"/>
        <result column="invoiceAmountCount" property="invoiceAmountCount"/>
    </resultMap>
    <!--月度统计-->
    <resultMap id="indexInvoiceChartStatisticsMap"
               type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceChartStatisticsModel">
        <result column="xzInvoiceCount" property="xzInvoiceCount"/>
        <result column="rzcgInvoiceCount" property="rzcgInvoiceCount"/>
        <result column="rzsbInvoiceCount" property="rzsbInvoiceCount"/>
        <result column="dayOfMonthInYear" property="dayOfMonthInYear"/>
        <result column="rzcgDayOfMonthInYear" property="rzcgDayOfMonthInYear"/>
        <result column="rzsbDayOfMonthInYear" property="rzsbDayOfMonthInYear"/>
    </resultMap>

    <!--任务提醒-->
    <resultMap id="indexInvoiceTaskRemindingMap"
               type="com.xforceplus.wapp.modules.index.entity.IndexInvoiceTaskRemindingModel">
        <result column="countNum" property="countNum"/>
        <result column="redType" property="redType"/>

    </resultMap>

    <sql id="indexInvoiceCollectionList">
        id, invoice_type, invoice_code, invoice_no, invoice_date, gf_tax_no, gf_name, gf_address_and_phone,
        gf_bank_and_no, xf_tax_no, xf_name, xf_address_and_phone, xf_bank_and_no, invoice_amount,
        tax_amount, total_amount, invoice_status, status_update_date, last_update_date, rzh_date,
        qs_date, rzh_belong_date_late, rzh_belong_date, confirm_date, rzh_type, rzh_yesorno,
        gx_user_account, gx_user_name, source_system, valid, uuid, create_date, gx_date,
        rzh_back_msg, dqskssq, gxjzr, gxfwq, gxfwz, sfygx, detail_yesorno, gx_type, auth_status,
        send_date, rzlx, sfdbts, qs_type, qs_status, check_code, txfbz, lslbz, out_status,
        out_invoice_amout, out_tax_amount, out_reason, out_date ,remark, out_remark
    </sql>

    <sql id="indexInvoiceScanningList">
        id, invoice_type, invoice_code, invoice_no, invoice_serial_no, gf_tax_no, gf_name,
        xf_tax_no, xf_name, invoice_amount, tax_amount, total_amount, invoice_date, user_account,
        user_name, qs_type, qs_status, valid, uuid, create_date, update_date, qs_date, scan_id,
        notes, check_code
    </sql>

    <!--权限-->
    <sql id="powerLimit">
        LEFT JOIN t_ac_org tao WITH(NOLOCK) ON tao.taxno = ${alias}.gf_tax_no
        LEFT JOIN t_ac_user_taxno taut ON taut.orgid = tao.orgid
        WHERE taut.userid =  #{paramsData.userId}
    </sql>

    <!--今日发票采集情况
    <select id="getInvoiceCollectionSituation"
            resultMap="indexInvoiceCollectionCountMap">
        /** mycat:schema=${schemaLabel}*/
        SELECT COUNT(1) countNum,
        CASE WHEN
        tdri.invoice_type = '01' THEN 'zpInvoiceCount'
        WHEN tdri.invoice_type = '03' THEN 'jdcInvoiceCount'
        WHEN tdri.invoice_type ='14' THEN 'txfInvoiceCount'
        END AS 'invoiceType'
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.source_system = '0'
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.create_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
        </if>
        GROUP BY tdri.invoice_type
        UNION
        SELECT COUNT(tdri.id) AS countNum,'wbmxInvoiceCount' FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.detail_yesorno = '0'
        AND tdri.source_system = '0'
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.create_date >= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
        </if>
    </select>
    -->

    <select id="getInvoiceCollectionSituationMap" resultType="map">
        SELECT
        sum(case when tdri.source_system = '0' then 1 else 0 end) as 'cjInvoiceCount',
        sum(case when tdri.source_system = '1' then 1 else 0 end) as 'cyInvoiceCount',
        sum(case when tdri.source_system = '2' then 1 else 0 end) as 'lrInvoiceCount'
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.create_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
        </if>
    </select>

    <select id="getInvoiceCollectionSituationMap1" resultType="map">
        SELECT
        sum(case when tdri.scan_match_status = '0' then 1 else 0 end) as 'smwInvoiceCount',
        sum(case when tdri.scan_match_status = '1' then 1 else 0 end) as 'smsInvoiceCount',
        sum(case when tdri.scan_match_status = '2' then 1 else 0 end) as 'smfInvoiceCount'
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.scan_match_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.scan_match_date<= #{paramsData.endDate} ]]>
        </if>
    </select>

    <!--今日发票采集列表-->
    <select id="getInvoiceCollectionSituationList"
            resultMap="IndexInvoiceCollectionMap">
        <if test="paramsData.offset != null and paramsData.limit != null">
            SELECT
            TOP (#{paramsData.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY create_date desc) AS rownumber, o.*
            FROM
            (
        </if>
        SELECT
        tdri.*
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.sourceSystem != null or paramsData.sourceSystem != ''">
            AND tdri.source_system = #{paramsData.sourceSystem}
        </if>
        <if test="paramsData.invoiceType == null or paramsData.invoiceType == ''">
            AND tdri.invoice_type IN ('01','03','14')
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.create_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
        </if>
        <if test="paramsData.detailYesOrNo != null and paramsData.detailYesOrNo != ''">
            AND tdri.detail_yesorno = '0'
        </if>
        <!--<if test="paramsData.offset != null and paramsData.limit != null">-->
            <!--limit #{paramsData.offset}, #{paramsData.limit}-->
        <!--</if>-->
        <if test="paramsData.offset == null and paramsData.limit == null">
            ORDER BY tdri.create_date desc
        </if>
        <if test="paramsData.offset != null and paramsData.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber >#{paramsData.offset}
        </if>
    </select>
    <!--今日发票采集列表记录数-->
    <select id="getInvoiceCollectionSituationListCount"
            resultType="Integer">
        SELECT
        count(1)
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.sourceSystem != null or paramsData.sourceSystem != ''">
            AND tdri.source_system = #{paramsData.sourceSystem}
        </if>
        <if test="paramsData.invoiceType == null or paramsData.invoiceType == ''">
            AND tdri.invoice_type IN ('01','03','14')
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.create_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
        </if>
        <if test="paramsData.detailYesOrNo != null and paramsData.detailYesOrNo != ''">
            AND tdri.detail_yesorno = '0'
        </if>
    </select>


    <!--今日扫描匹配列表-->
    <select id="getInvoiceCollectionSituationMatchList"
            resultMap="IndexInvoiceCollectionMap">
        <if test="paramsData.offset != null and paramsData.limit != null">
            SELECT
            TOP (#{paramsData.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY scan_match_date desc) AS rownumber, o.*
            FROM
            (
        </if>
        SELECT
        tdri.*
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.scanMatchStatus != null or paramsData.scanMatchStatus != ''">
            AND tdri.scan_match_status = #{paramsData.scanMatchStatus}
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.scan_match_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.scan_match_date<= #{paramsData.endDate} ]]>
        </if>
        <if test="paramsData.detailYesOrNo != null and paramsData.detailYesOrNo != ''">
            AND tdri.detail_yesorno = '0'
        </if>
        <!--<if test="paramsData.offset != null and paramsData.limit != null">-->
        <!--limit #{paramsData.offset}, #{paramsData.limit}-->
        <!--</if>-->
        <if test="paramsData.offset == null and paramsData.limit == null">
            ORDER BY tdri.scan_match_date desc
        </if>
        <if test="paramsData.offset != null and paramsData.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber >#{paramsData.offset}
        </if>
    </select>
    <!--今日扫描匹配记录数-->
    <select id="getInvoiceCollectionSituationListMatchCount"
            resultType="Integer">
        SELECT
        count(1)
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.scanMatchStatus != null or paramsData.scanMatchStatus != ''">
            AND tdri.scan_match_status = #{paramsData.scanMatchStatus}
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.scan_match_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.scan_match_date<= #{paramsData.endDate} ]]>
        </if>
        <if test="paramsData.detailYesOrNo != null and paramsData.detailYesOrNo != ''">
            AND tdri.detail_yesorno = '0'
        </if>
    </select>

    <!--今日申请已开红票列表-->
    <select id="getInvoiceCollectionSituationSQList"
            resultMap="IndexInvoiceScanMatchMap">
        <if test="paramsData.offset != null and paramsData.limit != null">
            SELECT
            TOP (#{paramsData.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY redticket_creation_time desc) AS rownumber, o.*
            FROM
            (
        </if>
        SELECT
        tdri.id,
        tdri.redticket_data_serial_number redticketDataSerialNumber,
        tdri.red_total_amount redTotalAmount,
        tdri.redticket_creation_time redticketCreationTime,
        tdri.invoice_type invoiceType,
        tdri.invoice_code invoiceCode,
        tdri.invoice_no invoiceNo,
        tdri.tax_rate taxRate,
        tdri.venderid venderId,
        tdri.gf_tax_no gfTaxNo,
        tdri.invoice_amount invoiceAmount,
        tdri.tax_amount taxAmount,
        tdri.total_amount totalAmount,
        FROM t_dx_red_ticket_matching tdri
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND (tdri.invoice_no = ''or tdri.invoice_no is null)
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)<= #{paramsData.endDate} ]]>
        </if>

        <!--<if test="paramsData.offset != null and paramsData.limit != null">-->
        <!--limit #{paramsData.offset}, #{paramsData.limit}-->
        <!--</if>-->
        <if test="paramsData.offset == null and paramsData.limit == null">
            ORDER BY tdri.redticket_creation_time desc
        </if>
        <if test="paramsData.offset != null and paramsData.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber >#{paramsData.offset}
        </if>
    </select>
    <!--今日申请已开红票记录数-->
    <select id="getInvoiceCollectionSituationListSQCount"
            resultType="Integer">
        SELECT
        count(1)
        FROM t_dx_red_ticket_matching tdri
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND (tdri.invoice_no = ''or tdri.invoice_no is null)
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)<= #{paramsData.endDate} ]]>
        </if>
    </select>

    <!--今日已开红票列表-->
    <select id="getInvoiceCollectionSituationYKList"
            resultMap="IndexInvoiceScanMatchMap">
        <if test="paramsData.offset != null and paramsData.limit != null">
            SELECT
            TOP (#{paramsData.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY redticket_creation_time desc) AS rownumber, o.*
            FROM
            (
        </if>
        SELECT
        tdri.id,
        tdri.redticket_data_serial_number redticketDataSerialNumber,
        tdri.red_total_amount redTotalAmount,
        tdri.redticket_creation_time redticketCreationTime,
        tdri.invoice_type invoiceType,
        tdri.invoice_code invoiceCode,
        tdri.invoice_no invoiceNo,
        tdri.tax_rate taxRate,
        tdri.venderid venderId,
        tdri.gf_tax_no gfTaxNo,
        tdri.invoice_amount invoiceAmount,
        tdri.tax_amount taxAmount,
        tdri.total_amount totalAmount,
        FROM t_dx_red_ticket_matching tdri
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND (tdri.invoice_no != ''or tdri.invoice_no is not null)
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)<= #{paramsData.endDate} ]]>
        </if>

        <!--<if test="paramsData.offset != null and paramsData.limit != null">-->
        <!--limit #{paramsData.offset}, #{paramsData.limit}-->
        <!--</if>-->
        <if test="paramsData.offset == null and paramsData.limit == null">
            ORDER BY tdri.redticket_creation_time desc
        </if>
        <if test="paramsData.offset != null and paramsData.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber >#{paramsData.offset}
        </if>
    </select>
    <!--今日已开红票记录数-->
    <select id="getInvoiceCollectionSituationListYKCount"
            resultType="Integer">
        SELECT
        count(1)
        FROM t_dx_red_ticket_matching tdri
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND (tdri.invoice_no != ''or tdri.invoice_no is not null)
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)<= #{paramsData.endDate} ]]>
        </if>
    </select>

    <!--今日发票采集列表-->
    <select id="getInvoiceCollectionSituationWqsList"
            resultMap="IndexInvoiceCollectionMap">
        <if test="paramsData.offset != null and paramsData.limit != null">
            SELECT
            TOP (#{paramsData.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY create_date desc) AS rownumber, o.*
            FROM
            (
        </if>
        SELECT
        tdri.*
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.qsStatus != null or paramsData.qsStatus != ''">
            AND tdri.qs_status = #{paramsData.qsStatus}
        </if>
        <if test="paramsData.invoiceType == null or paramsData.invoiceType == ''">
            AND tdri.invoice_type IN ('01','03','14')
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.create_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
        </if>
        <if test="paramsData.detailYesOrNo != null and paramsData.detailYesOrNo != ''">
            AND tdri.detail_yesorno = '0'
        </if>
        <!--<if test="paramsData.offset != null and paramsData.limit != null">-->
        <!--limit #{paramsData.offset}, #{paramsData.limit}-->
        <!--</if>-->
        <if test="paramsData.offset == null and paramsData.limit == null">
            ORDER BY tdri.create_date desc
        </if>
        <if test="paramsData.offset != null and paramsData.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber >#{paramsData.offset}
        </if>
    </select>
    <!--今日发票采集列表记录数-->
    <select id="getInvoiceCollectionSituationWqsListCount"
            resultType="Integer">
        SELECT
        count(1)
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.qsStatus != null or paramsData.qsStatus != ''">
            AND tdri.qs_status = #{paramsData.qsStatus}
        </if>
        <if test="paramsData.invoiceType == null or paramsData.invoiceType == ''">
            AND tdri.invoice_type IN ('01','03','14')
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.create_date>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
        </if>
        <if test="paramsData.detailYesOrNo != null and paramsData.detailYesOrNo != ''">
            AND tdri.detail_yesorno = '0'
        </if>
    </select>


    <!--今日发票扫描情况-->
    <select id="getInvoiceScanningSituation"
            resultMap="indexInvoiceScanningCountMap">
        SELECT COUNT(1) countNum,
        CASE WHEN
        tdi.qs_status = '0' THEN 'wqsCount'
        WHEN tdi.qs_status = '1' THEN 'yqsCount'
        END AS 'qsType'
        FROM t_dx_invoice tdi WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdi"/>
        </include>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[   AND convert(varchar(100),tdi.qs_date,20) >= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[   AND convert(varchar(100),tdi.qs_date,20) <= #{paramsData.endDate} ]]>
        </if>
        GROUP BY tdi.qs_status
        UNION
        SELECT COUNT(1) countNum,'totalCount' AS qsType
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.qs_status = '0'
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[  AND convert(varchar(100),tdri.qs_date,20) >= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[  AND convert(varchar(100),tdri.qs_date,20) <= #{paramsData.endDate} ]]>
        </if>
    </select>
    <!--今日发票扫描列表-->
    <select id="getInvoiceScanningSituationList"
            resultMap="IndexInvoiceScanningMap">
        <if test="paramsData.offset != null and paramsData.limit != null">
            SELECT
            TOP (#{paramsData.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY qs_date desc) AS rownumber, o.*
            FROM
            (
        </if>
        SELECT
        tdi.*
        FROM t_dx_invoice tdi WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdi"/>
        </include>
        <if test="paramsData.qsStatus != null and paramsData.qsStatus != ''">
            AND tdi.qs_status = #{paramsData.qsStatus}
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdi.qs_date,20) >= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdi.qs_date,20) <= #{paramsData.endDate} ]]>
        </if>
       <!-- <if test="paramsData.offset != null and paramsData.limit != null">
            limit #{paramsData.offset}, #{paramsData.limit}
        </if>-->
        <if test="paramsData.offset == null and paramsData.limit == null">
            ORDER BY tdri.qs_date desc
        </if>
        <if test="paramsData.offset != null and paramsData.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber >#{paramsData.offset}
        </if>
    </select>

    <!--今日发票扫描列表记录数-->
    <select id="getInvoiceScanningSituationListCount"
            resultType="Integer">
        SELECT
        count(1)
        FROM t_dx_invoice tdi WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdi"/>
        </include>
        <if test="paramsData.qsStatus != null and paramsData.qsStatus != ''">
            AND tdi.qs_status = #{paramsData.qsStatus}
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdi.qs_date,20) >= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdi.qs_date,20) <= #{paramsData.endDate} ]]>
        </if>

    </select>

    <!--今日发票认证列表-->
    <select id="getInvoiceAuthenticationSituationList"
            resultMap="IndexInvoiceCollectionMap">
        <if test="paramsData.offset != null and paramsData.limit != null">
            SELECT
            TOP (#{paramsData.limit}) A.*
            FROM
            (
            SELECT
            row_number () OVER (ORDER BY create_date desc) AS rownumber, o.*
            FROM
            (
        </if>
        SELECT tdri.* from t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.rzStatus == 'cgList'.toString()">
            AND tdri.auth_status='4'
        </if>
        <if test="paramsData.rzStatus == 'sbList'.toString()">
            AND tdri.auth_status='5'
        </if>
        <if test="paramsData.rzStatus == 'wei'.toString()">
            AND tdri.rzh_yesorno='0'
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.rzh_date,20) >= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.rzh_date,20) <= #{paramsData.endDate} ]]>
        </if>
        <!--<if test="paramsData.offset != null and paramsData.limit != null">
            limit #{paramsData.offset}, #{paramsData.limit}
        </if>-->
        <if test="paramsData.offset == null and paramsData.limit == null">
            ORDER BY tdri.create_date desc
        </if>
        <if test="paramsData.offset != null and paramsData.limit != null">
            )
            AS o
            )A
            WHERE
            rownumber >#{paramsData.offset}
        </if>
    </select>


    <!--今日发票认证列表记录数-->
    <select id="getInvoiceAuthenticationSituationListCount"
            resultType="Integer">
        SELECT count(1) from t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.rzStatus == 'cgList'.toString()">
            AND tdri.auth_status='4'
        </if>
        <if test="paramsData.rzStatus == 'sbList'.toString()">
            AND tdri.auth_status='5'
        </if>
        <if test="paramsData.rzStatus == 'wei'.toString()">
            AND tdri.rzh_yesorno='0'
        </if>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.rzh_date,20) >= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.rzh_date,20) <= #{paramsData.endDate} ]]>
        </if>
    </select>
    <!--今日发票认证情况-->
    <select id="getInvoiceAuthenticationSituation"
            resultMap="indexInvoiceAuthenticationCountMap">
        SELECT count(1) countNum,
        CASE
        WHEN tdri.auth_status='5'
        THEN 'rzsbType'
        WHEN tdri.auth_status='4'
        THEN 'rzcgType'
        END AS 'authenticationType'
        from t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.rzh_date,20)>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.rzh_date,20)<= #{paramsData.endDate} ]]>
        </if>
        GROUP BY tdri.auth_status
        UNION
        SELECT COUNT(1) countNum,'fsrzType' AS authenticationType
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='0'
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.rzh_date,20)>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.rzh_date,20)<= #{paramsData.endDate} ]]>
        </if>
    </select>
    <!--本月新增发票信息-->
    <select id="getInvoiceInformationOfMonth"
            resultMap="indexInvoiceInformationOfMonthMap">
        SELECT COUNT(1) AS 'xzInvoice',
        ( SELECT
        count(1)
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='1'
        AND tdri.rzh_belong_date =  DATE_FORMAT(now(),'%Y%m')) AS 'yrzInvoice',
        (SELECT truncate(sum(tdri.tax_amount),2) from t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='1'
        AND tdri.rzh_belong_date = DATE_FORMAT(now(),'%Y%m')
        ) AS 'taxAmountCount'#已认证发票金额(未税),保留两位小数
        ,(SELECT truncate(sum(tdri.invoice_amount),2) from t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='1'
        AND tdri.rzh_belong_date = DATE_FORMAT(now(),'%Y%m')
        ) AS 'invoiceAmountCount' #已认证发票税额,保留两位小数
        from t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.invoice_type IN ('01','03', '14')
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.create_date,20)>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.create_date,20)<= #{paramsData.endDate} ]]>
        </if>
    </select>

    <!--月度统计图表getInvoiceChartStatistics-->
    <select id="getInvoiceChartStatistics"
            resultMap="indexInvoiceChartStatisticsMap">
        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzsb.dateTime AS 'rzsbDayOfMonthInYear',
        outter_outter_tdri_rzsb.rzsbCount AS 'rzsbInvoiceCount'
        FROM (
            SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
                (SELECT 'xzType' AS 'InvoiceType',convert(varchar(100),tdri.create_date,23) AS dateTime
                FROM t_dx_record_invoice tdri WITH(NOLOCK)
                <include refid="powerLimit">
                    <property name="alias" value="tdri"/>
                </include>
                AND tdri.invoice_type IN ('01','03','14')
                <![CDATA[ AND tdri.create_date>= (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20)) ]]>
                <if test="paramsData.endDate != null and paramsData.endDate != ''">
                    <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
                </if>
            ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
            (SELECT 'rzcgType' AS 'InvoiceType',convert(varchar(100),tdri.rzh_date,23) AS dateTime from
            t_dx_record_invoice tdri WITH(NOLOCK)
            <include refid="powerLimit">
                <property name="alias" value="tdri"/>
            </include>
            AND tdri.rzh_yesorno='1'
            <![CDATA[ AND tdri.rzh_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
            <if test="paramsData.endDate != null and paramsData.endDate != ''">
                <![CDATA[ AND tdri.rzh_date<= #{paramsData.endDate}  ]]>
            </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzcg.dateTime

        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzsbCount',outter_tdri.dateTime FROM
        (SELECT 'rzsbType' AS 'InvoiceType',convert(varchar(100),tdri.rzh_date,23) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='0'
        <![CDATA[ AND tdri.rzh_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.rzh_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzsb
        ON outter_outter_tdri_rzcg.dateTime=outter_outter_tdri_rzsb.dateTime

        UNION

        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzsb.dateTime AS 'rzsbDayOfMonthInYear',
        outter_outter_tdri_rzsb.rzsbCount AS 'rzsbInvoiceCount'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',convert(varchar(100),tdri.rzh_date,23) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.invoice_type IN ('01','03','14')
        <![CDATA[ AND tdri.create_date>= (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20)) ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.create_date<= #{paramsData.endDate} ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',convert(varchar(100),tdri.rzh_date,23) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='1'
        <![CDATA[ AND tdri.rzh_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.rzh_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzcg.dateTime

        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzsbCount',outter_tdri.dateTime FROM
        (SELECT 'rzsbType' AS 'InvoiceType',convert(varchar(100),tdri.rzh_date,23) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='0'
        <![CDATA[ AND tdri.rzh_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.rzh_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzsb
        ON outter_outter_tdri_rzcg.dateTime=outter_outter_tdri_rzsb.dateTime
    </select>

    <!--月度统计图表getInvoiceChartStatisticsQS-->
    <select id="getInvoiceChartStatisticsQS"
            resultMap="indexInvoiceChartStatisticsMap">
        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzsb.dateTime AS 'rzsbDayOfMonthInYear',
        outter_outter_tdri_rzsb.rzsbCount AS 'rzsbInvoiceCount'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',convert(varchar(100),tdri.qs_date,23) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.qs_status = '0'
        <![CDATA[ AND tdri.qs_date>= (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20)) ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.qs_date<= #{paramsData.endDate} ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',convert(varchar(100),tdri.qs_date,23) AS dateTime from
        t_dx_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.qs_status='1'
        <![CDATA[ AND tdri.qs_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.qs_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzcg.dateTime
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzsbCount',outter_tdri.dateTime FROM
        (SELECT 'rzsbType' AS 'InvoiceType',convert(varchar(100),tdri.qs_date,23) AS dateTime from
        t_dx_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.qs_status='0'
        <![CDATA[ AND tdri.qs_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.qs_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzsb
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzsb.dateTime

        UNION

        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzsb.dateTime AS 'rzsbDayOfMonthInYear',
        outter_outter_tdri_rzsb.rzsbCount AS 'rzsbInvoiceCount'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',convert(varchar(100),tdri.qs_date,23) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.qs_status='0'
        <![CDATA[ AND tdri.qs_date>= (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20)) ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.qs_date<= #{paramsData.endDate} ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',convert(varchar(100),tdri.qs_date,23) AS dateTime from
        t_dx_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.qs_status='1'
        <![CDATA[ AND tdri.qs_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.qs_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzcg.dateTime
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzsbCount',outter_tdri.dateTime FROM
        (SELECT 'rzsbType' AS 'InvoiceType',convert(varchar(100),tdri.qs_date,23) AS dateTime from
        t_dx_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.qs_status='0'
        <![CDATA[ AND tdri.qs_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.qs_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzsb
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzsb.dateTime
    </select>


    <!--月度统计图表getInvoiceChartStatisticsSM-->
    <select id="getInvoiceChartStatisticsSM"
            resultMap="indexInvoiceChartStatisticsMap">
        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',convert(varchar(100),tdri.scan_match_date,23) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <!--AND tdri.invoice_type IN ('01','03','14')-->
        <!--and tdri.rzh_yesorno = '0'-->
        and tdri.scan_match_status = '0'
        <![CDATA[ AND tdri.scan_match_date>= (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20)) ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.scan_match_date<= #{paramsData.endDate} ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',convert(varchar(100),tdri.scan_match_date,23) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.scan_match_status='1'
        <![CDATA[ AND tdri.scan_match_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.scan_match_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzcg.dateTime

        UNION

        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',convert(varchar(100),tdri.scan_match_date,23) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <!-- AND tdri.invoice_type IN ('01','03','14')-->
        <!--and tdri.rzh_yesorno = '0'-->
        AND tdri.scan_match_status='0'
        <![CDATA[ AND tdri.scan_match_date>= (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20)) ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.scan_match_date<= #{paramsData.endDate} ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',convert(varchar(100),tdri.scan_match_date,23) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        <!--AND tdri.rzh_yesorno='1'-->
        AND tdri.scan_match_status='1'
        <![CDATA[ AND tdri.scan_match_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.scan_match_date<= #{paramsData.endDate}  ]]>
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzcg.dateTime
    </select>

    <!--任务提醒-->
    <select id="getInvoiceTaskReminding"
            resultMap="indexInvoiceTaskRemindingMap">
        SELECT COUNT(1) AS 'countNum','sqType' as 'redType' FROM
        t_dx_red_ticket_matching
        as tdri
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND (tdri.invoice_no = ''or tdri.invoice_no is null)
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)>= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND convert(varchar(100),tdri.redticket_creation_time,20)<= #{paramsData.endDate} ]]>
        </if>
        UNION
        SELECT COUNT(1) AS 'countNum','ykType' AS 'redType' from t_dx_red_ticket_matching AS tdri
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND (tdri.invoice_no != ''or tdri.invoice_no is not null)
        <if test="paramsData.startDate != null and paramsData.startDate != ''">
            <![CDATA[ AND tdri.redticket_creation_time >= #{paramsData.startDate} ]]>
        </if>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            <![CDATA[ AND tdri.redticket_creation_time <= #{paramsData.endDate} ]]>
        </if>

    </select>

    <!--年度统计图表-->
    <select id="getInvoiceChartStatisticsYear"
            resultMap="indexInvoiceChartStatisticsMap">
        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.create_date,23),0,8) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.invoice_type IN ('01','03','14')
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.create_date,23),0,5)= #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),cast(tdri.rzh_belong_date+'01' as datetime),23),0,8) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='1'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),cast(tdri.rzh_belong_date+'01' as datetime),23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg ON outter_outter_tdri.dateTime=
        outter_outter_tdri_rzcg.dateTime
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzsbCount',outter_tdri.dateTime FROM
        (SELECT 'rzsbType' AS 'InvoiceType',convert(varchar(100),tdri.rzh_date,23) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='0'
        <![CDATA[ AND tdri.rzh_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),cast(tdri.rzh_belong_date+'01' as datetime),23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzsb
        ON outter_outter_tdri_rzcg.dateTime=outter_outter_tdri_rzsb.dateTime

        UNION

        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.create_date,23),0,8) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.invoice_type IN ('01','03','14')
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.create_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),cast(tdri.rzh_belong_date+'01' as datetime),23),0,8) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='1'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),cast(tdri.rzh_belong_date+'01' as datetime),23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg ON outter_outter_tdri.dateTime=
        outter_outter_tdri_rzcg.dateTime
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzsbCount',outter_tdri.dateTime FROM
        (SELECT 'rzsbType' AS 'InvoiceType',convert(varchar(100),tdri.rzh_date,23) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='0'
        <![CDATA[ AND tdri.rzh_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),cast(tdri.rzh_belong_date+'01' as datetime),23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzsb
        ON outter_outter_tdri_rzcg.dateTime=outter_outter_tdri_rzsb.dateTime

    </select>

    <!--年度统计图表-->
    <select id="getInvoiceChartStatisticsYearQS"
            resultMap="indexInvoiceChartStatisticsMap">
        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear',
        outter_outter_tdri_rzsb.dateTime AS 'rzsbDayOfMonthInYear',
        outter_outter_tdri_rzsb.rzsbCount AS 'rzsbInvoiceCount'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,8) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.qs_status = '0'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,5)= #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,8) AS dateTime from
        t_dx_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.qs_status = '1'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg ON outter_outter_tdri.dateTime=
        outter_outter_tdri_rzcg.dateTime
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzsbCount',outter_tdri.dateTime FROM
        (SELECT 'rzsbType' AS 'InvoiceType',convert(varchar(100),tdri.qs_date,23) AS dateTime from
        t_dx_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.qs_status='0'
        <![CDATA[ AND tdri.qs_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzsb
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzsb.dateTime

        UNION

        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear',
        outter_outter_tdri_rzsb.dateTime AS 'rzsbDayOfMonthInYear',
        outter_outter_tdri_rzsb.rzsbCount AS 'rzsbInvoiceCount'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,8) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.qs_status = '0'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,8) AS dateTime from
        t_dx_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.qs_status = '1'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg ON outter_outter_tdri.dateTime=
        outter_outter_tdri_rzcg.dateTime
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzsbCount',outter_tdri.dateTime FROM
        (SELECT 'rzsbType' AS 'InvoiceType',convert(varchar(100),tdri.qs_date,23) AS dateTime from
        t_dx_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.qs_status='0'
        <![CDATA[ AND tdri.qs_date>=  (select convert(varchar(100),dateadd(day, -day(getdate())+1,getdate()),20))  ]]>
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.qs_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzsb
        ON outter_outter_tdri.dateTime=outter_outter_tdri_rzsb.dateTime

    </select>

    <!--年度统计图表-->
    <select id="getInvoiceChartStatisticsYearSM"
            resultMap="indexInvoiceChartStatisticsMap">
        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.scan_match_date,23),0,8) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.scan_match_status = '0'
        <!-- AND tdri.invoice_type IN ('01','04')-->
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.scan_match_date,23),0,5)= #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        LEFT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.scan_match_date,23),0,8) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.scan_match_status = '1'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.scan_match_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg ON outter_outter_tdri.dateTime=
        outter_outter_tdri_rzcg.dateTime

        UNION

        SELECT outter_outter_tdri.xzCount AS 'xzInvoiceCount',
        outter_outter_tdri.dateTime AS 'dayOfMonthInYear',
        outter_outter_tdri_rzcg.rzcgCount AS 'rzcgInvoiceCount',
        outter_outter_tdri_rzcg.dateTime AS 'rzcgDayOfMonthInYear'
        FROM (
        SELECT COUNT(outter_tdri.InvoiceType) AS 'xzCount',outter_tdri.dateTime FROM
        (SELECT 'xzType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.scan_match_date,23),0,8) AS dateTime
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.scan_match_status = '0'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.scan_match_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime
        ) outter_outter_tdri
        RIGHT JOIN
        (SELECT COUNT(outter_tdri.InvoiceType) AS 'rzcgCount',outter_tdri.dateTime FROM
        (SELECT 'rzcgType' AS 'InvoiceType',SUBSTRING(convert(varchar(100),tdri.scan_match_date,23),0,8) AS dateTime from
        t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        and tdri.scan_match_status = '1'
        <if test="paramsData.endDate != null and paramsData.endDate != ''">
            AND SUBSTRING(convert(varchar(100),tdri.scan_match_date,23),0,5) = #{paramsData.endDate}
        </if>
        ) outter_tdri GROUP BY outter_tdri.dateTime) outter_outter_tdri_rzcg ON outter_outter_tdri.dateTime=
        outter_outter_tdri_rzcg.dateTime


    </select>



    <!-- 本月已认证发票数量 -->
  <!--  <select id="getCurrentMonthAuthCount" resultType="Integer">
        SELECT
        count(1)
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='1'
        AND tdri.rzh_belong_date =  DATE_FORMAT(now(),'%Y%m')
    </select>-->

    <!-- 本月已认证发票列表 -->
   <!-- <select id="getCurrentMonthAuthList" resultMap="IndexInvoiceCollectionMap">
        SELECT
        tdri.*
        FROM t_dx_record_invoice tdri WITH(NOLOCK)
        <include refid="powerLimit">
            <property name="alias" value="tdri"/>
        </include>
        AND tdri.rzh_yesorno='1'
        AND tdri.rzh_belong_date =  DATE_FORMAT(now(),'%Y%m')
        <if test="paramsData.offset != null and paramsData.limit != null">
            limit #{paramsData.offset}, #{paramsData.limit}
        </if>
    </select>-->
</mapper>
