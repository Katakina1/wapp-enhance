<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xforceplus.wapp.modules.index.dao.IndexMainWalmartDao">
    <sql id="indexList">
        id, invoice_type, invoice_code, invoice_no, invoice_date, gf_tax_no, gf_name, gf_address_and_phone,
        gf_bank_and_no, xf_tax_no, xf_name, xf_address_and_phone, xf_bank_and_no, invoice_amount,
        tax_amount, total_amount, invoice_status, status_update_date, last_update_date, rzh_date,
        qs_date, rzh_belong_date_late, rzh_belong_date, confirm_date, rzh_type, rzh_yesorno,
        gx_user_account, gx_user_name, source_system, valid, uuid, create_date, gx_date,
        rzh_back_msg, dqskssq, gxjzr, gxfwq, gxfwz, sfygx, detail_yesorno, gx_type, auth_status,
        send_date, rzlx, sfdbts, qs_type, qs_status, check_code, txfbz, lslbz, out_status,
        out_invoice_amout, out_tax_amount, out_reason, out_date ,remark, out_remark,
        ROW_NUMBER() OVER(Order by create_date) AS rownum
    </sql>

    <sql id="scanField">
        id, invoice_type, invoice_code, invoice_no, invoice_date, gf_tax_no, gf_name,
        xf_tax_no, xf_name,  invoice_amount,
        tax_amount, total_amount,
        qs_date, valid, uuid, create_date, qs_type, qs_status,
        ROW_NUMBER() OVER(Order by create_date) AS rownum
    </sql>

    <sql id="redField">
        id,
        redticket_data_serial_number redticketDataSerialNumber,
        red_total_amount redTotalAmount,
        redticket_creation_time redticketCreationTime,
        invoice_type invoiceType,
        invoice_code invoiceCode,
        invoice_no invoiceNo,
        tax_rate taxRate,
        venderid venderId,
        gf_tax_no gfTaxNo,
        invoice_amount invoiceAmount,
        tax_amount taxAmount,
        total_amount totalAmount,
        ROW_NUMBER() OVER(Order by redticket_creation_time) AS rownum
    </sql>

    <sql id="powerLimit">
        and gf_tax_no=(select taxno from t_ac_org WITH(NOLOCK) where orgid=(select orgid from t_ac_user WITH(NOLOCK) where userid=#{userId}))
    </sql>


    <!--发票采集-->
    <select id="queryList1" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and source_system='0'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount1" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and source_system='0'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--发票查验-->
    <select id="queryList2" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and source_system='1'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount2" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and source_system='1'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--发票录入-->
    <select id="queryList3" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and source_system='2'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount3" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and source_system='2'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--签收成功-->
    <select id="queryList4" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="scanField"></include>
        from t_dx_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and qs_status='1'
        and convert(varchar(10),qs_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount4" resultType="int">
        select count(1) from t_dx_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and qs_status='1'
        and convert(varchar(10),qs_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--签收失败-->
    <select id="queryList5" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="scanField"></include>
        from t_dx_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and qs_status='0'
        and convert(varchar(10),qs_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount5" resultType="int">
        select count(1) from t_dx_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and qs_status='0'
        and convert(varchar(10),qs_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--认证成功-->
    <select id="queryList6" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and rzh_yesorno='1' and auth_status='4'
        and convert(varchar(10),rzh_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount6" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and rzh_yesorno='1' and auth_status='4'
        and convert(varchar(10),rzh_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--认证失败-->
    <select id="queryList7" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and rzh_yesorno='1' and auth_status='5'
        and convert(varchar(10),rzh_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount7" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and rzh_yesorno='1' and auth_status='5'
        and convert(varchar(10),rzh_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--未认证-->
    <select id="queryList8" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and rzh_yesorno='0' and invoice_type='01'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount8" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and rzh_yesorno='0' and invoice_type='01'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--扫描匹配成功-->
    <select id="queryList9" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and scan_match_status='1'
        and convert(varchar(10),scan_match_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount9" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and scan_match_status='1'
        and convert(varchar(10),scan_match_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--扫描匹配失败-->
    <select id="queryList10" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and scan_match_status='2'
        and convert(varchar(10),scan_match_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount10" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and scan_match_status='2'
        and convert(varchar(10),scan_match_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--未扫描匹配-->
    <select id="queryList11" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="indexList"></include>
        from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and scan_match_status='0' and detail_yesorno='0'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount11" resultType="int">
        select count(1) from t_dx_record_invoice WITH(NOLOCK) where valid='1'
        <include refid="powerLimit"></include>
        and scan_match_status='0' and detail_yesorno='0'
        and convert(varchar(10),create_date,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--已开红票-->
    <select id="queryList13" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="redField"></include>
        from t_dx_red_ticket_matching where 1=1
        <include refid="powerLimit"></include>
        and whether_open_redticket='1'
        and convert(varchar(10),redticket_creation_time,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount13" resultType="int">
        select count(1) from t_dx_red_ticket_matching where 1=1
        <include refid="powerLimit"></include>
        and whether_open_redticket='1'
        and convert(varchar(10),redticket_creation_time,23) = convert(varchar(10),GETDATE(),23)
    </select>

    <!--申请开红票-->
    <select id="queryList12" resultType="com.xforceplus.wapp.modules.report.entity.ComprehensiveInvoiceQueryEntity">
        select * from (
        select <include refid="redField"></include>
        from t_dx_red_ticket_matching where 1=1
        <include refid="powerLimit"></include>
        and audit_results='2'
        and convert(varchar(10),redticket_creation_time,23) = convert(varchar(10),GETDATE(),23)
        ) a where <![CDATA[rownum>#{offset} and rownum<=#{offset}+#{limit}]]>
    </select>
    <select id="queryCount12" resultType="int">
        select count(1) from t_dx_red_ticket_matching where 1=1
        <include refid="powerLimit"></include>
        and audit_results='2'
        and convert(varchar(10),redticket_creation_time,23) = convert(varchar(10),GETDATE(),23)
    </select>
</mapper>